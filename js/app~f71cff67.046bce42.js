(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app~f71cff67"],{"0194":function(e,a,t){"use strict";t("fabc")},"040c":function(e,a,t){e.exports=t.p+"jhm/img/cardIcon.29b867b5.svg"},"16e2":function(e,a,t){"use strict";t("a573");var l=function(){var e=this,a=e._self._c;return a("section",{staticClass:"table-section"},[e.loading?a("div",{staticClass:"loading-overlay"},[a("div",{staticClass:"spinner"})]):e._e(),e.error?a("div",{staticClass:"error-message"},[e._v(" "+e._s(e.error)+" ")]):e._e(),a("div",{staticClass:"table-header"},[a("div",{staticClass:"header-left"},[a("h2",[e._v("通道列表")]),a("div",{staticClass:"header-actions"},[a("div",{staticClass:"view-toggle"},[a("button",{staticClass:"view-toggle-btn",class:{active:"card"===e.viewMode},attrs:{title:"卡片视图"},on:{click:e.toggleViewMode}},[a("i",{staticClass:"fas fa-th"})]),a("button",{staticClass:"view-toggle-btn",class:{active:"table"===e.viewMode},attrs:{title:"表格视图"},on:{click:e.toggleViewMode}},[a("i",{staticClass:"fas fa-table"})])])])]),a("div",{staticClass:"header-right"},[a("div",{staticClass:"search-container"},[a("i",{staticClass:"fas fa-search search-icon"}),a("input",{directives:[{name:"model",rawName:"v-model",value:e.searchQuery,expression:"searchQuery"}],staticClass:"search-input",attrs:{type:"text",placeholder:"搜索通道...","aria-label":"搜索通道"},domProps:{value:e.searchQuery},on:{input:function(a){a.target.composing||(e.searchQuery=a.target.value)}}}),e.searchQuery?a("button",{staticClass:"clear-search-btn",attrs:{title:"清除搜索"},on:{click:function(a){e.searchQuery=""}}},[a("i",{staticClass:"fas fa-times"})]):e._e()])])]),"card"===e.viewMode?a("div",{staticClass:"channel-cards"},e._l(e.filteredChannels,(function(t){return a("div",{key:t.id,staticClass:"channel-card",class:{enabled:"启用"===t.status,disabled:"未启用"===t.status}},[a("div",{staticClass:"card-header"},[a("div",{staticClass:"card-title-area"},[a("h3",{staticClass:"card-title"},[e._v(e._s(t.name))]),a("div",{staticClass:"channel-type-icons"},["支付宝/微信"===t.type?[a("span",{staticClass:"wechat-icon card-icon",attrs:{title:"微信"}}),a("span",{staticClass:"alipay-icon card-icon",attrs:{title:"支付宝"}})]:"支付宝"===t.type?a("span",{staticClass:"alipay-icon card-icon",attrs:{title:"支付宝"}}):"微信"===t.type?a("span",{staticClass:"wechat-icon card-icon",attrs:{title:"微信"}}):a("span",{staticClass:"channel-type-badge text-badge"},[e._v(e._s(t.type))])],2)]),a("span",{staticClass:"channel-status",class:{"status-enabled":"启用"===t.status,"status-disabled":"未启用"===t.status},on:{click:function(a){return e.toggleStatus(t)}}},[a("span",{staticClass:"status-dot"}),e._v(" "+e._s(t.status)+" ")])]),a("div",{staticClass:"card-body"},[a("div",{staticClass:"info-grid"},[a("div",{staticClass:"info-item"},[e._m(0,!0),a("div",{staticClass:"info-content"},[a("span",{staticClass:"info-label"},[e._v("通道标识")]),a("span",{staticClass:"info-value"},[e._v(e._s(t.identifier))])])]),a("div",{staticClass:"info-item"},[e._m(1,!0),a("div",{staticClass:"info-content"},[a("span",{staticClass:"info-label"},[e._v("添加时间")]),a("span",{staticClass:"info-value"},[e._v(e._s(t.addTime))])])]),a("div",{staticClass:"info-item"},[e._m(2,!0),a("div",{staticClass:"info-content"},[a("span",{staticClass:"info-label"},[e._v("在线人数")]),a("span",{staticClass:"info-value"},[e._v(e._s(t.onlineUsers))])])]),a("div",{staticClass:"info-item"},[e._m(3,!0),a("div",{staticClass:"info-content"},[a("span",{staticClass:"info-label"},[e._v("累计金额")]),a("span",{staticClass:"info-value"},[e._v("¥"+e._s(t.totalAmount))])])])])]),a("div",{staticClass:"card-actions"},[a("button",{staticClass:"btn-qr",on:{click:function(a){return e.generateQR(t)}}},[a("i",{staticClass:"fas fa-qrcode"}),a("span",[e._v("生成二维码")])]),a("button",{staticClass:"btn-settings",on:{click:function(a){return e.openSettings(t)}}},[a("i",{staticClass:"fas fa-cog"}),a("span",[e._v("参数设置")])])])])})),0):a("div",{staticClass:"table-wrapper"},[a("div",{staticClass:"table-container"},[a("table",{attrs:{id:"channelTable",role:"table","aria-label":"通道列表"}},[a("thead",[a("tr",e._l(e.tableHeaders,(function(t){return a("th",{key:t,class:{"action-header":"操作"===t,"status-header":"状态"===t}},[a("div",{staticClass:"th-content"},[a("i",{staticClass:"header-icon",class:e.getHeaderIcon(t)}),a("span",{staticClass:"header-text"},[e._v(e._s(t))])])])})),0)]),a("tbody",e._l(e.filteredChannels,(function(t){return a("tr",{key:t.id,class:{"enabled-row":"启用"===t.status,"disabled-row":"未启用"===t.status}},[a("td",{staticClass:"id-cell"},[e._v(e._s(t.id))]),a("td",[a("div",{staticClass:"channel-type-cell"},["支付宝/微信"===t.type?[a("span",{staticClass:"wechat-icon table-icon",attrs:{title:"微信"}}),a("span",{staticClass:"alipay-icon table-icon",attrs:{title:"支付宝"}})]:"支付宝"===t.type?a("span",{staticClass:"alipay-icon table-icon",attrs:{title:"支付宝"}}):"微信"===t.type?a("span",{staticClass:"wechat-icon table-icon",attrs:{title:"微信"}}):a("span",{staticClass:"type-text"},[e._v(e._s(t.type))])],2)]),a("td",[a("div",{staticClass:"channel-name"},[e._v(e._s(t.name))])]),a("td",{staticClass:"identifier-cell"},[a("div",{staticClass:"identifier-wrapper"},[a("i",{staticClass:"fas fa-fingerprint identifier-icon"}),a("span",[e._v(e._s(t.identifier))])])]),a("td",[a("div",{staticClass:"date-wrapper"},[a("i",{staticClass:"fas fa-calendar-alt date-icon"}),a("span",[e._v(e._s(t.addTime))])])]),a("td",{staticClass:"numeric-cell"},[a("div",{staticClass:"users-wrapper"},[a("i",{staticClass:"fas fa-users users-icon"}),a("span",[e._v(e._s(t.onlineUsers))])])]),a("td",{staticClass:"numeric-cell amount-cell"},[a("div",{staticClass:"amount-wrapper"},[a("i",{staticClass:"fas fa-money-bill-wave amount-icon"}),a("span",[e._v("¥"+e._s(t.totalAmount))])])]),a("td",{staticClass:"actions-cell"},[a("div",{staticClass:"actions-wrapper"},[a("button",{staticClass:"btn-action btn-qr",attrs:{title:"生成二维码"},on:{click:function(a){return e.generateQR(t)}}},[a("i",{staticClass:"fas fa-qrcode"}),a("span",{staticClass:"btn-text"},[e._v("生成二维码")])]),a("button",{staticClass:"btn-action btn-settings",attrs:{title:"参数设置"},on:{click:function(a){return e.openSettings(t)}}},[a("i",{staticClass:"fas fa-cog"}),a("span",{staticClass:"btn-text"},[e._v("参数设置")])])])]),a("td",{staticClass:"status-cell"},[a("span",{staticClass:"channel-status",class:{"status-enabled":"启用"===t.status,"status-disabled":"未启用"===t.status},attrs:{role:"button",tabindex:"0",title:"点击"+("启用"===t.status?"禁用":"启用")+"通道"},on:{click:function(a){return e.toggleStatus(t)}}},[a("span",{staticClass:"status-dot"}),e._v(" "+e._s(t.status)+" ")])])])})),0)])]),0===e.filteredChannels.length?a("div",{staticClass:"no-data-state"},[e._m(4),a("p",{staticClass:"no-data-text"},[e._v("没有找到匹配的通道")]),e.searchQuery?a("button",{staticClass:"clear-search",on:{click:function(a){e.searchQuery=""}}},[e._v(" 清除搜索 ")]):e._e()]):e._e()]),e.showModal?a("div",{staticClass:"modal",attrs:{id:"modal"}},[a("div",{staticClass:"modal-content",class:{"qr-modal":"qr"===e.modalType,"settings-modal":"settings"===e.modalType}},[a("span",{staticClass:"close-button",on:{click:e.closeModal}},[e._v("×")]),"qr"===e.modalType?a("div",{staticClass:"qr-content"},[a("h3",[e._v("通道支付二维码")]),e.domains.length>0?a("div",{staticClass:"domain-selector"},[a("label",{attrs:{for:"domain-select"}},[e._v("选择域名:")]),a("el-select",{attrs:{id:"domain-select",placeholder:"请选择"},on:{change:function(a){return e.generateQR(e.currentChannel)}},model:{value:e.selectedDomain,callback:function(a){e.selectedDomain=a},expression:"selectedDomain"}},e._l(e.domains,(function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e.name}})})),1)],1):e._e(),a("div",{staticClass:"qr-image-container"},[e.qrCodeUrl?a("img",{attrs:{src:e.qrCodeUrl,alt:"二维码图片"}}):e._e()]),e.qrCodeUrl?a("div",{staticClass:"qr-actions"},[a("button",{staticClass:"btn-save-qr",on:{click:e.saveQRCode}},[a("i",{staticClass:"fas fa-download"}),e._v(" 保存二维码 ")])]):a("p",[e._v(e._s(e.modalMessage))])]):"settings"===e.modalType?a("div",{staticClass:"settings-container"},[a("div",{staticClass:"settings-header"},[e._m(5),a("div",{staticClass:"header-text"},[a("h3",[e._v("参数设置")]),a("p",[e._v("通道: "+e._s(e.currentChannel.name)+" (ID: "+e._s(e.currentChannel.id)+")")])])]),a("div",{staticClass:"settings-body"},[a("div",{staticClass:"settings-tabs"},[a("button",{staticClass:"tab-btn",class:{active:"basic"===e.activeTab},on:{click:function(a){e.activeTab="basic"}}},[a("i",{staticClass:"fas fa-cogs"}),e._v(" 基本设置 ")]),a("button",{staticClass:"tab-btn",class:{active:"payment"===e.activeTab},on:{click:function(a){e.activeTab="payment"}}},[a("i",{staticClass:"fas fa-credit-card"}),e._v(" 支付参数 ")]),a("button",{staticClass:"tab-btn",class:{active:"features"===e.activeTab},on:{click:function(a){e.activeTab="features"}}},[a("i",{staticClass:"fas fa-toggle-on"}),e._v(" 功能开关 ")]),a("button",{staticClass:"tab-btn",class:{active:"security"===e.activeTab},on:{click:function(a){e.activeTab="security"}}},[a("i",{staticClass:"fas fa-shield-alt"}),e._v(" 安全设置 ")])]),a("form",{staticClass:"settings-form",on:{submit:function(a){return a.preventDefault(),e.saveSettings.apply(null,arguments)}}},[a("div",{directives:[{name:"show",rawName:"v-show",value:"basic"===e.activeTab,expression:"activeTab === 'basic'"}],staticClass:"tab-content"},[a("div",{staticClass:"form-section"},[a("h4",{staticClass:"section-title"},[e._v("通道状态")]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"status"}},[e._v("通道状态")]),a("div",{staticClass:"custom-select"},[a("select",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.status,expression:"currentChannel.status"}],attrs:{id:"status"},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.currentChannel,"status",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:"启用"}},[e._v("启用")]),a("option",{attrs:{value:"未启用"}},[e._v("未启用")])]),a("i",{staticClass:"fas fa-chevron-down select-arrow"})])])]),a("div",{staticClass:"form-section"},[a("h4",{staticClass:"section-title"},[e._v("公告设置")]),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"announcement-enabled"}},[e._v("启用公告")]),a("el-switch",{attrs:{id:"announcement-enabled"},model:{value:e.currentChannel.announcement.enabled,callback:function(a){e.$set(e.currentChannel.announcement,"enabled",a)},expression:"currentChannel.announcement.enabled"}})],1),a("transition",{attrs:{name:"slide-fade"}},[e.currentChannel.announcement.enabled?a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"announcement"}},[e._v("公告内容")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.announcement.content,expression:"currentChannel.announcement.content"}],attrs:{id:"announcement",placeholder:"请输入公告内容，支持多行文本",rows:"4"},domProps:{value:e.currentChannel.announcement.content},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.announcement,"content",a.target.value)}}})]):e._e()])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:"payment"===e.activeTab,expression:"activeTab === 'payment'"}],staticClass:"tab-content"},[a("div",{staticClass:"form-section"},[a("h4",{staticClass:"section-title"},[e._v("支付参数 ("+e._s(e.currentChannel.identifier)+")")]),a("div",{staticClass:"form-section"},[a("h4",{staticClass:"section-title"},[e._v("金额限制")]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"minAmount"}},[e._v("最小支付金额")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.minAmount,expression:"currentChannel.minAmount"}],attrs:{type:"number",id:"minAmount",placeholder:"请输入最小金额，0表示不限制"},domProps:{value:e.currentChannel.minAmount},on:{input:function(a){a.target.composing||e.$set(e.currentChannel,"minAmount",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"maxAmount"}},[e._v("最大支付金额")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.maxAmount,expression:"currentChannel.maxAmount"}],attrs:{type:"number",id:"maxAmount",placeholder:"请输入最大金额，0表示不限制"},domProps:{value:e.currentChannel.maxAmount},on:{input:function(a){a.target.composing||e.$set(e.currentChannel,"maxAmount",a.target.value)}}})])]),"lilipay"===e.currentChannel.identifier?[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"merchantId"}},[e._v("商户ID")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.merchantId,expression:"currentChannel.customParams.merchantId"}],attrs:{type:"text",id:"merchantId",placeholder:"请输入商户ID"},domProps:{value:e.currentChannel.customParams.merchantId},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"merchantId",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"key"}},[e._v("商户密钥")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.key,expression:"currentChannel.customParams.key"}],attrs:{type:"password",id:"key",placeholder:"请输入商户密钥"},domProps:{value:e.currentChannel.customParams.key},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"key",a.target.value)}}})])]:"f2f"===e.currentChannel.identifier?[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"userId"}},[e._v("商户ID")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.userId,expression:"currentChannel.customParams.userId"}],attrs:{type:"text",id:"userId",placeholder:"请输入商户ID"},domProps:{value:e.currentChannel.customParams.userId},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"userId",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"directJumpUrl"}},[e._v("直接跳转链接")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.directJumpUrl,expression:"currentChannel.customParams.directJumpUrl"}],attrs:{type:"text",id:"directJumpUrl",placeholder:"请输入直接跳转链接(可选)"},domProps:{value:e.currentChannel.customParams.directJumpUrl},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"directJumpUrl",a.target.value)}}})]),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"enableDirectJump"}},[e._v("启用直接跳转")]),a("el-switch",{attrs:{id:"enableDirectJump"},model:{value:e.currentChannel.customParams.enableDirectJump,callback:function(a){e.$set(e.currentChannel.customParams,"enableDirectJump",a)},expression:"currentChannel.customParams.enableDirectJump"}}),e.currentChannel.customParams.enableDirectJump?a("div",{staticClass:"info-box"},[a("p",[e._v("启用后，用户扫码将直接跳转到设置的链接，不显示支付页面")])]):e._e()],1)]:"ysm"===e.currentChannel.identifier?[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"appid"}},[e._v("appid")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.appid,expression:"currentChannel.customParams.appid"}],attrs:{type:"text",id:"appid",placeholder:"请输入appid"},domProps:{value:e.currentChannel.customParams.appid},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"appid",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"appSecret"}},[e._v("appSecret")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.appSecret,expression:"currentChannel.customParams.appSecret"}],attrs:{type:"password",id:"appSecret",placeholder:"请输入appSecret"},domProps:{value:e.currentChannel.customParams.appSecret},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"appSecret",a.target.value)}}})])]:"ZFBZZ"===e.currentChannel.identifier?[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"userId"}},[e._v("支付宝用户ID")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.userId,expression:"currentChannel.customParams.userId"}],attrs:{type:"text",id:"userId",placeholder:"请输入支付宝用户ID (chatUserId)"},domProps:{value:e.currentChannel.customParams.userId},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"userId",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"displayName"}},[e._v("显示名称")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.displayName,expression:"currentChannel.customParams.displayName"}],attrs:{type:"text",id:"displayName",placeholder:"请输入显示名称"},domProps:{value:e.currentChannel.customParams.displayName},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"displayName",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"chatUserName"}},[e._v("用户名称")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.chatUserName,expression:"currentChannel.customParams.chatUserName"}],attrs:{type:"text",id:"chatUserName",placeholder:"请输入用户名称"},domProps:{value:e.currentChannel.customParams.chatUserName},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"chatUserName",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"chatLoginId"}},[e._v("登录ID")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.chatLoginId,expression:"currentChannel.customParams.chatLoginId"}],attrs:{type:"text",id:"chatLoginId",placeholder:"请输入登录ID (如156******05)"},domProps:{value:e.currentChannel.customParams.chatLoginId},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"chatLoginId",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"directJumpUrl"}},[e._v("直接跳转链接")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.directJumpUrl,expression:"currentChannel.customParams.directJumpUrl"}],attrs:{type:"text",id:"directJumpUrl",placeholder:"请输入直接跳转链接(可选)"},domProps:{value:e.currentChannel.customParams.directJumpUrl},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"directJumpUrl",a.target.value)}}})]),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"enableDirectJump"}},[e._v("启用直接跳转")]),a("el-switch",{attrs:{id:"enableDirectJump"},model:{value:e.currentChannel.customParams.enableDirectJump,callback:function(a){e.$set(e.currentChannel.customParams,"enableDirectJump",a)},expression:"currentChannel.customParams.enableDirectJump"}}),e.currentChannel.customParams.enableDirectJump?a("div",{staticClass:"info-box"},[a("p",[e._v("启用后，用户扫码将直接跳转到设置的链接，不显示支付页面")])]):e._e()],1)]:"golden"===e.currentChannel.identifier?[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"userId"}},[e._v("支付宝账号UID")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.userId,expression:"currentChannel.customParams.userId"}],attrs:{type:"text",id:"userId",placeholder:"请输入支付宝账号UID"},domProps:{value:e.currentChannel.customParams.userId},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"userId",a.target.value)}}})])]:"wxtoqq"===e.currentChannel.identifier?[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"userId"}},[e._v("商户ID")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.userId,expression:"currentChannel.customParams.userId"}],attrs:{type:"text",id:"userId",placeholder:"请输入商户ID"},domProps:{value:e.currentChannel.customParams.userId},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"userId",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"qqNumber"}},[e._v("QQ号码")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.qqNumber,expression:"currentChannel.customParams.qqNumber"}],attrs:{type:"text",id:"qqNumber",placeholder:"请输入QQ号码"},domProps:{value:e.currentChannel.customParams.qqNumber},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"qqNumber",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"realName"}},[e._v("真实姓名")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.realName,expression:"currentChannel.customParams.realName"}],attrs:{type:"text",id:"realName",placeholder:"请输入真实姓名"},domProps:{value:e.currentChannel.customParams.realName},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"realName",a.target.value)}}})])]:"hkrt"===e.currentChannel.identifier?[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"token"}},[e._v("Token")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.token,expression:"currentChannel.customParams.token"}],attrs:{type:"text",id:"token",placeholder:"请输入mini_token值"},domProps:{value:e.currentChannel.customParams.token},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"token",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"cookie"}},[e._v("Cookie (可选)")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.cookie,expression:"currentChannel.customParams.cookie"}],attrs:{type:"text",id:"cookie",placeholder:"请输入Cookie值"},domProps:{value:e.currentChannel.customParams.cookie},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"cookie",a.target.value)}}})])]:[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"customUserId"}},[e._v(e._s(e.isPaymentChannel(e.currentChannel.name)?"支付参数":"用户ID"))]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currentChannel.customParams.userId,expression:"currentChannel.customParams.userId"}],attrs:{type:"text",id:"customUserId",placeholder:e.isPaymentChannel(e.currentChannel.name)?"请输入支付参数":"请输入用户ID"},domProps:{value:e.currentChannel.customParams.userId},on:{input:function(a){a.target.composing||e.$set(e.currentChannel.customParams,"userId",a.target.value)}}})])]],2)]),a("div",{directives:[{name:"show",rawName:"v-show",value:"features"===e.activeTab,expression:"activeTab === 'features'"}],staticClass:"tab-content"},[a("div",{staticClass:"form-section"},[a("h4",{staticClass:"section-title"},[e._v("功能开关")]),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"wechat-guide"}},[e._v("微信浏览器引导")]),"f2f"===e.currentChannel.identifier?a("el-switch",{attrs:{id:"wechat-guide"},model:{value:e.currentChannel.customParams.wechatGuideEnabled,callback:function(a){e.$set(e.currentChannel.customParams,"wechatGuideEnabled",a)},expression:"currentChannel.customParams.wechatGuideEnabled"}}):e._e(),"f2f"===e.currentChannel.identifier?a("div",{staticClass:"info-box"},[a("p",[e._v("启用后，用户在微信内打开支付页面时会显示引导提示，引导用户使用浏览器打开")])]):e._e()],1),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"chat-feature"}},[e._v("启用聊天功能")]),a("el-switch",{attrs:{id:"chat-feature"},model:{value:e.currentChannel.chatFeature.enabled,callback:function(a){e.$set(e.currentChannel.chatFeature,"enabled",a)},expression:"currentChannel.chatFeature.enabled"}}),e._m(6)],1),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"name-required"}},[e._v("需要用户姓名")]),a("el-switch",{attrs:{id:"name-required"},model:{value:e.currentChannel.nameRequired.enabled,callback:function(a){e.$set(e.currentChannel.nameRequired,"enabled",a)},expression:"currentChannel.nameRequired.enabled"}}),e._m(7)],1)])]),a("div",{directives:[{name:"show",rawName:"v-show",value:"security"===e.activeTab,expression:"activeTab === 'security'"}],staticClass:"tab-content"},[a("div",{staticClass:"form-section"},[a("h4",{staticClass:"section-title"},[e._v("安全设置")]),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"random-decimal"}},[e._v("随机小数点")]),["ZFBZZ","golden","wxtoqq","hkrt"].includes(e.currentChannel.identifier)?[a("el-switch",{attrs:{id:"random-decimal"},model:{value:e.currentChannel.customParams.randomDecimal,callback:function(a){e.$set(e.currentChannel.customParams,"randomDecimal",a)},expression:"currentChannel.customParams.randomDecimal"}}),e.currentChannel.customParams.randomDecimal?a("div",{staticClass:"info-box"},[["ZFBZZ","golden"].includes(e.currentChannel.identifier)?a("p",[e._v("启用后，支付金额将随机减少0.01-0.09元")]):a("p",[e._v("启用后，支付金额将随机减少0.01-0.99元")])]):e._e()]:a("p",{staticClass:"text-muted"},[e._v("当前通道不支持此功能")])],2),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"share-blacklist"}},[e._v("共享黑名单")]),a("el-switch",{attrs:{id:"share-blacklist"},on:{change:e.handleShareBlacklistChange},model:{value:e.currentChannel.shareBlacklist.enabled,callback:function(a){e.$set(e.currentChannel.shareBlacklist,"enabled",a)},expression:"currentChannel.shareBlacklist.enabled"}}),e.currentChannel.shareBlacklist.enabled?a("div",{staticClass:"info-box"},[a("p",[e._v("启用后，其他用户拉黑的IP将无法扫描您的支付码，提高安全性")])]):e._e()],1)]),a("div",{staticClass:"form-section"},[a("h4",{staticClass:"section-title"},[e._v("地区禁用")]),a("div",{staticClass:"form-group switch-group"},[a("label",{attrs:{for:"region-blacklist"}},[e._v("启用地区禁用")]),a("el-switch",{attrs:{id:"region-blacklist"},model:{value:e.currentChannel.regionBlacklist.enabled,callback:function(a){e.$set(e.currentChannel.regionBlacklist,"enabled",a)},expression:"currentChannel.regionBlacklist.enabled"}})],1),e.currentChannel.regionBlacklist.enabled?a("div",{staticClass:"region-settings"},[a("el-button",{staticClass:"add-rule-btn",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addRule}},[e._v("添加地区规则")]),e.hasBlockedRegions?a("div",{staticClass:"blocked-regions"},[a("div",{staticClass:"tags-container"},[e._l(e.currentChannel.regionBlacklist.provinces,(function(t){return a("el-tag",{key:t,staticClass:"province-tag",attrs:{type:"danger"}},[e._v(e._s(e.getProvinceLabel(t)))])})),e._l(e.currentChannel.regionBlacklist.cities,(function(t){return a("el-tag",{key:t,staticClass:"city-tag",attrs:{type:"warning"}},[e._v(e._s(e.getCityLabel(t,e.findProvinceByCity(t))))])}))],2)]):e._e(),a("div",{staticClass:"region-rules"},e._l(e.regionRules,(function(t,l){return a("div",{key:l,staticClass:"region-rule-row"},[a("el-select",{staticClass:"province-select",attrs:{filterable:"",placeholder:"选择省份"},on:{change:a=>e.handleProvinceChange(a,l)},model:{value:t.province,callback:function(a){e.$set(t,"province",a)},expression:"rule.province"}},e._l(e.availableProvinces,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("el-select",{staticClass:"city-select",attrs:{multiple:"",filterable:"",placeholder:"选择城市",disabled:!t.province},on:{change:function(a){return e.handleCitiesChange(t.province,a)}},model:{value:t.cities,callback:function(a){e.$set(t,"cities",a)},expression:"rule.cities"}},e._l(e.getCitiesByProvince(t.province),(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("el-button",{staticClass:"remove-btn",attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){return e.removeRule(l)}}})],1)})),0)],1):e._e()])])])]),a("div",{staticClass:"settings-footer"},[a("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:e.closeModal}},[e._v("取 消")]),a("button",{staticClass:"btn-save",attrs:{type:"button",disabled:e.isSaving},on:{click:e.saveSettings}},[e.isSaving?a("i",{staticClass:"fas fa-spinner fa-spin"}):a("span",[e._v("保 存")])])])]):e._e()])]):e._e()])},s=[function(){var e=this,a=e._self._c;return a("div",{staticClass:"info-icon"},[a("i",{staticClass:"fas fa-fingerprint"})])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"info-icon"},[a("i",{staticClass:"fas fa-calendar-alt"})])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"info-icon"},[a("i",{staticClass:"fas fa-users"})])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"info-icon"},[a("i",{staticClass:"fas fa-money-bill-wave"})])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"no-data-icon"},[a("i",{staticClass:"fas fa-search"})])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-icon"},[a("i",{staticClass:"fas fa-sliders-h"})])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"info-box"},[a("p",[e._v("启用后，用户可以在支付页面使用聊天功能进行交流")])])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"info-box"},[a("p",[e._v("启用后，用户在支付时需要输入真实姓名")])])}],n=(t("14d9"),t("1e70"),t("79a4"),t("c1a1"),t("8b00"),t("a4e7"),t("1e5a"),t("72c3"),t("0643"),t("2382"),t("fffc"),t("4e3e"),t("9a9a"),t("be92")),i=t("9d74"),r={name:"ChannelTable",data(){return{loading:!1,error:null,searchQuery:"",viewMode:localStorage.getItem("channelViewMode")||"table",showModal:!1,modalType:"",modalMessage:"",qrCodeUrl:"",selectedDomain:"",activeTab:"basic",currentChannel:{customParams:{},announcement:{enabled:!1,content:""},shareBlacklist:{enabled:!1,excludedUsers:[]},regionBlacklist:{enabled:!1,provinces:[],cities:[]},chatFeature:{enabled:!1},nameRequired:{enabled:!1},minAmount:0,maxAmount:0},tableHeaders:["ID","通道类型","通道名称","通道标识","添加时间","在线人数","累计金额","操作","状态"],channels:[],isMobile:!1,isSaving:!1,provinces:[{value:"北京",label:"北京市"},{value:"天津",label:"天津市"},{value:"河北",label:"河北省"},{value:"山西",label:"山西省"},{value:"内蒙古",label:"内蒙古自治区"},{value:"辽宁",label:"辽宁省"},{value:"吉林",label:"吉林省"},{value:"黑龙江",label:"黑龙江省"},{value:"上海",label:"上海市"},{value:"江苏",label:"江苏省"},{value:"浙江",label:"浙江省"},{value:"安徽",label:"安徽省"},{value:"福建",label:"福建省"},{value:"江西",label:"江西省"},{value:"山东",label:"山东省"},{value:"河南",label:"河南省"},{value:"湖北",label:"湖北省"},{value:"湖南",label:"湖南省"},{value:"广东",label:"广东省"},{value:"广西",label:"广西壮族自治区"},{value:"海南",label:"海南省"},{value:"重庆",label:"重庆市"},{value:"四川",label:"四川省"},{value:"贵州",label:"贵州省"},{value:"云南",label:"云南省"},{value:"西藏",label:"西藏自治区"},{value:"陕西",label:"陕西省"},{value:"甘肃",label:"甘肃省"},{value:"青海",label:"青海省"},{value:"宁夏",label:"宁夏回族自治区"},{value:"新疆",label:"新疆维吾尔自治区"}],cities:{"北京":[{value:"北京",label:"北京市"}],"天津":[{value:"天津",label:"天津市"}],"河北":[{value:"石家庄",label:"石家庄市"},{value:"唐山",label:"唐山市"},{value:"秦皇岛",label:"秦皇岛市"},{value:"邯郸",label:"邯郸市"},{value:"邢台",label:"邢台市"},{value:"保定",label:"保定市"},{value:"张家口",label:"张家口市"},{value:"承德",label:"承德市"},{value:"沧州",label:"沧州市"},{value:"廊坊",label:"廊坊市"},{value:"衡水",label:"衡水市"}],"山西":[{value:"太原",label:"太原市"},{value:"大同",label:"大同市"},{value:"阳泉",label:"阳泉市"},{value:"长治",label:"长治市"},{value:"晋城",label:"晋城市"},{value:"朔州",label:"朔州市"},{value:"晋中",label:"晋中市"},{value:"临汾",label:"临汾市"},{value:"运城",label:"运城市"}],"内蒙古":[{value:"呼和浩特",label:"呼和浩特市"},{value:"包头",label:"包头市"},{value:"乌海",label:"乌海市"},{value:"张家口",label:"张家口市"},{value:"锡林郭勒盟",label:"锡林郭勒盟"},{value:"赤峰",label:"赤峰市"},{value:"通辽",label:"通辽市"},{value:"鄂尔多斯",label:"鄂尔多斯市"},{value:"呼伦贝尔",label:"呼伦贝尔市"}],"辽宁":[{value:"沈阳",label:"沈阳市"},{value:"大连",label:"大连市"},{value:"鞍山",label:"鞍山市"},{value:"抚顺",label:"抚顺市"},{value:"本溪",label:"本溪市"},{value:"丹东",label:"丹东市"},{value:"锦州",label:"锦州市"},{value:"营口",label:"营口市"},{value:"阜新",label:"阜新市"},{value:"辽阳",label:"辽阳市"},{value:"盘锦",label:"盘锦市"},{value:"铁岭",label:"铁岭市"},{value:"朝阳",label:"朝阳市"}],"吉林":[{value:"长春",label:"长春市"},{value:"吉林",label:"吉林市"},{value:"四平",label:"四平市"},{value:"辽源",label:"辽源市"},{value:"通化",label:"通化市"},{value:"白山",label:"白山市"},{value:"松原",label:"松原市"},{value:"白城",label:"白城市"}],"黑龙江":[{value:"哈尔滨",label:"哈尔滨市"},{value:"大庆",label:"大庆市"},{value:"齐齐哈尔",label:"齐齐哈尔市"},{value:"鸡西",label:"鸡西市"},{value:"双鸭山",label:"双鸭山市"},{value:"鹤岗",label:"鹤岗市"},{value:"绥化",label:"绥化市"},{value:"黑河",label:"黑河市"},{value:"伊春",label:"伊春市"},{value:"铁力",label:"铁力市"}],"上海":[{value:"上海",label:"上海市"}],"江苏":[{value:"南京",label:"南京市"},{value:"苏州",label:"苏州市"},{value:"无锡",label:"无锡市"},{value:"徐州",label:"徐州市"},{value:"常州",label:"常州市"},{value:"南通",label:"南通市"},{value:"连云港",label:"连云港市"},{value:"扬州",label:"扬州市"},{value:"盐城",label:"盐城市"},{value:"镇江",label:"镇江市"},{value:"泰州",label:"泰州市"},{value:"宿迁",label:"宿迁市"}],"浙江":[{value:"杭州",label:"杭州市"},{value:"宁波",label:"宁波市"},{value:"温州",label:"温州市"},{value:"嘉兴",label:"嘉兴市"},{value:"湖州",label:"湖州市"},{value:"绍兴",label:"绍兴市"},{value:"金华",label:"金华市"},{value:"衢州",label:"衢州市"},{value:"舟山",label:"舟山市"},{value:"丽水",label:"丽水市"}],"安徽":[{value:"合肥",label:"合肥市"},{value:"芜湖",label:"芜湖市"},{value:"蚌埠",label:"蚌埠市"},{value:"淮南",label:"淮南市"},{value:"马鞍山",label:"马鞍山市"},{value:"淮北",label:"淮北市"},{value:"铜陵",label:"铜陵市"},{value:"安庆",label:"安庆市"},{value:"黄山",label:"黄山市"},{value:"滁州",label:"滁州市"},{value:"阜阳",label:"阜阳市"},{value:"宿州",label:"宿州市"},{value:"六安",label:"六安市"}],"福建":[{value:"福州",label:"福州市"},{value:"厦门",label:"厦门市"},{value:"泉州",label:"泉州市"},{value:"莆田",label:"莆田市"},{value:"漳州",label:"漳州市"},{value:"南平",label:"南平市"},{value:"三明",label:"三明市"},{value:"龙岩",label:"龙岩市"},{value:"宁德",label:"宁德市"}],"江西":[{value:"南昌",label:"南昌市"},{value:"景德镇",label:"景德镇市"},{value:"抚州",label:"抚州市"},{value:"九江",label:"九江市"},{value:"新余",label:"新余市"},{value:"赣州",label:"赣州市"},{value:"井冈山",label:"井冈山市"},{value:"上饶",label:"上饶市"}],"河南":[{value:"郑州",label:"郑州市"},{value:"开封",label:"开封市"},{value:"洛阳",label:"洛阳市"},{value:"平顶山",label:"平顶山市"},{value:"安阳",label:"安阳市"},{value:"鹤壁",label:"鹤壁市"},{value:"濮阳",label:"濮阳市"},{value:"许昌",label:"许昌市"},{value:"漯河",label:"漯河市"},{value:"三门峡",label:"三门峡市"},{value:"南阳",label:"南阳市"},{value:"新乡",label:"新乡市"},{value:"驻马店",label:"驻马店市"},{value:"沁阳",label:"沁阳市"}],"湖北":[{value:"武汉",label:"武汉市"},{value:"黄石",label:"黄石市"},{value:"十堰",label:"十堰市"},{value:"宜昌",label:"宜昌市"},{value:"襄阳",label:"襄阳市"},{value:"鄂州",label:"鄂州市"},{value:"荆门",label:"荆门市"},{value:"孝感",label:"孝感市"},{value:"荆州",label:"荆州市"},{value:"黄冈",label:"黄冈市"},{value:"咸宁",label:"咸宁市"},{value:"随州",label:"随州市"},{value:"恩施",label:"恩施土家族苗族自治州"},{value:"仙桃",label:"仙桃市"},{value:"潜江",label:"潜江市"},{value:"天门",label:"天门市"},{value:"神农架",label:"神农架林区"}],"湖南":[{value:"长沙",label:"长沙市"},{value:"株洲",label:"株洲市"},{value:"湘潭",label:"湘潭市"},{value:"衡阳",label:"衡阳市"},{value:"邵阳",label:"邵阳市"},{value:"岳阳",label:"岳阳市"},{value:"常德",label:"常德市"},{value:"张家界",label:"张家界市"},{value:"益阳",label:"益阳市"},{value:"郴州",label:"郴州市"},{value:"永州",label:"永州市"},{value:"怀化",label:"怀化市"},{value:"娄底",label:"娄底市"},{value:"湘西",label:"湘西土家族苗族自治州"}],"广东":[{value:"广州",label:"广州市"},{value:"韶关",label:"韶关市"},{value:"深圳",label:"深圳市"},{value:"珠海",label:"珠海市"},{value:"汕头",label:"汕头市"},{value:"佛山",label:"佛山市"},{value:"江门",label:"江门市"},{value:"湛江",label:"湛江市"},{value:"茂名",label:"茂名市"},{value:"肇庆",label:"肇庆市"},{value:"惠州",label:"惠州市"},{value:"梅州",label:"梅州市"},{value:"汕尾",label:"汕尾市"},{value:"河源",label:"河源市"},{value:"阳江",label:"阳江市"},{value:"清远",label:"清远市"},{value:"东莞",label:"东莞市"},{value:"中山",label:"中山市"},{value:"潮州",label:"潮州市"},{value:"揭阳",label:"揭阳市"},{value:"云浮",label:"云浮市"}],"广西":[{value:"南宁",label:"南宁市"},{value:"柳州",label:"柳州市"},{value:"桂林",label:"桂林市"},{value:"梧州",label:"梧州市"},{value:"北海",label:"北海市"},{value:"防城港",label:"防城港市"},{value:"钦州",label:"钦州市"},{value:"贵港",label:"贵港市"},{value:"玉林",label:"玉林市"},{value:"百色",label:"百色市"},{value:"贺州",label:"贺州市"},{value:"河池",label:"河池市"},{value:"来宾",label:"来宾市"},{value:"崇左",label:"崇左市"}],"海南":[{value:"海口",label:"海口市"},{value:"三亚",label:"三亚市"},{value:"三沙",label:"三沙市"},{value:"儋州",label:"儋州市"},{value:"文昌",label:"文昌市"},{value:"琼海",label:"琼海市"},{value:"万宁",label:"万宁市"},{value:"东方",label:"东方市"},{value:"定安",label:"定安县"},{value:"屯昌",label:"屯昌县"},{value:"澄迈",label:"澄迈县"},{value:"临高",label:"临高县"},{value:"白沙",label:"白沙黎族自治县"},{value:"昌江",label:"昌江黎族自治县"},{value:"乐东",label:"乐东黎族自治县"},{value:"陵水",label:"陵水黎族自治县"},{value:"保亭",label:"保亭黎族苗族自治县"},{value:"琼中",label:"琼中黎族苗族自治县"}],"重庆":[{value:"万州",label:"万州区"},{value:"涪陵",label:"涪陵区"},{value:"渝中",label:"渝中区"},{value:"大渡口",label:"大渡口区"},{value:"江北",label:"江北区"},{value:"沙坪坝",label:"沙坪坝区"},{value:"九龙坡",label:"九龙坡区"},{value:"南岸",label:"南岸区"},{value:"北碚",label:"北碚区"},{value:"綦江",label:"綦江区"},{value:"大足",label:"大足区"},{value:"渝北",label:"渝北区"},{value:"巴南",label:"巴南区"},{value:"黔江",label:"黔江区"},{value:"长寿",label:"长寿区"},{value:"江津",label:"江津区"},{value:"合川",label:"合川区"},{value:"永川",label:"永川区"},{value:"南川",label:"南川区"},{value:"璧山",label:"璧山区"},{value:"铜梁",label:"铜梁区"},{value:"潼南",label:"潼南区"},{value:"荣昌",label:"荣昌区"},{value:"开州",label:"开州区"},{value:"梁平",label:"梁平区"},{value:"武隆",label:"武隆区"},{value:"城口",label:"城口县"},{value:"丰都",label:"丰都县"},{value:"垫江",label:"垫江县"},{value:"忠县",label:"忠县"},{value:"云阳",label:"云阳县"},{value:"奉节",label:"奉节县"},{value:"巫山",label:"巫山县"},{value:"巫溪",label:"巫溪县"},{value:"石柱",label:"石柱土家族自治县"},{value:"秀山",label:"秀山土家族苗族自治县"},{value:"酉阳",label:"酉阳土家族苗族自治县"},{value:"彭水",label:"彭水苗族土家族自治县"}],"四川":[{value:"成都",label:"成都市"},{value:"自贡",label:"自贡市"},{value:"攀枝花",label:"攀枝花市"},{value:"德阳",label:"德阳市"},{value:"绵阳",label:"绵阳市"},{value:"南充",label:"南充市"},{value:"广安",label:"广安市"},{value:"达州",label:"达州市"},{value:"宜宾",label:"宜宾市"},{value:"内江",label:"内江市"},{value:"乐山",label:"乐山市"},{value:"泸州",label:"泸州市"},{value:"攀枝花",label:"攀枝花  "},{value:"资阳",label:"资阳市"},{value:"眉山",label:"眉山市"},{value:"遂宁",label:"遂宁市"}],"贵州":[{value:"贵阳",label:"贵阳市"},{value:"六盘水",label:"六盘水市"},{value:"遵义",label:"遵义市"},{value:"安顺",label:"安顺市"},{value:"毕节",label:"毕节市"},{value:"铜仁",label:"铜仁市"},{value:"黔西南",label:"黔西南布依族苗族自治州"},{value:"黔东南",label:"黔东南苗族侗族自治州"},{value:"黔南",label:"黔南布依族苗族自治州"}],"云南":[{value:"昆明",label:"昆明市"},{value:"曲靖",label:"曲靖市"},{value:"玉溪",label:"玉溪市"},{value:"保山",label:"保山市"},{value:"丽江",label:"丽江市"},{value:"大理白族自治州",label:"大理白族自治州"},{value:"昭通",label:"昭通市"},{value:"楚雄彝族自治州",label:"楚雄彝族自治州"},{value:"红河哈尼族彝族自治州",label:"红河哈尼族彝族自治州"},{value:"文山壮族苗族自治州",label:"文山壮族苗族自治州"},{value:"怒江傈僳族自治州",label:"怒江傈僳族自治州"},{value:"迪庆藏族自治州",label:"迪庆藏族自治州"}],"西藏":[{value:"拉萨",label:"拉萨市"},{value:"山南",label:"山南市"},{value:"日喀则",label:"日喀则市"},{value:"狮子山大典",label:"狮子山大典市"},{value:"林芝",label:"林芝市"},{value:"那曲",label:"那曲市"},{value:"阿里地区",label:"阿里地区"}],"青海":[{value:"西宁",label:"西宁市"},{value:"海东",label:"海东市"},{value:"海北",label:"海北藏族自治州"},{value:"黄南",label:"黄南藏族自治州"},{value:"海南",label:"海南藏族自治州"},{value:"果洛",label:"果洛藏族自治州"},{value:"玉树",label:"玉树藏族自治州"},{value:"海西",label:"海西蒙古族藏族自治州"}],"宁夏":[{value:"银川",label:"银川市"},{value:"石嘴山",label:"石嘴山市"},{value:"吴忠",label:"吴忠市"},{value:"固原",label:"固原市"},{value:"中卫",label:"中卫市"}],"新疆":[{value:"乌鲁木齐",label:"乌鲁木齐市"},{value:"克拉玛依",label:"克拉玛依市"},{value:"吐鲁番",label:"吐鲁番市"},{value:"哈密",label:"哈密市"},{value:"昌吉",label:"昌吉回族自治州"},{value:"博尔塔拉",label:"博尔塔拉蒙古自治州"},{value:"巴音郭楞",label:"巴音郭楞蒙古自治州"},{value:"阿克苏",label:"阿克苏地区"},{value:"克孜勒苏",label:"克孜勒苏柯尔克孜自治州"},{value:"喀什",label:"喀什地区"},{value:"和田",label:"和田地区"},{value:"伊犁",label:"伊犁哈萨克自治州"},{value:"塔城",label:"塔城地区"},{value:"阿勒泰",label:"阿勒泰地区"},{value:"石河子",label:"石河子市"},{value:"阿拉尔",label:"阿拉尔市"},{value:"图木舒克",label:"图木舒克市"},{value:"五家渠",label:"五家渠市"},{value:"北屯",label:"北屯市"},{value:"铁门关",label:"铁门关市"},{value:"双河",label:"双河市"},{value:"可克达拉",label:"可克达拉市"},{value:"昆玉",label:"昆玉市"},{value:"胡杨河",label:"胡杨河市"}],"山东":[{value:"济南",label:"济南市"},{value:"青岛",label:"青岛市"},{value:"淄博",label:"淄博市"},{value:"枣庄",label:"枣庄市"},{value:"东营",label:"东营市"},{value:"烟台",label:"烟台市"},{value:"潍坊",label:"潍坊市"},{value:"济宁",label:"济宁市"},{value:"泰安",label:"泰安市"},{value:"威海",label:"威海市"},{value:"日照",label:"日照市"},{value:"临沂",label:"临沂市"},{value:"德州",label:"德州市"},{value:"聊城",label:"聊城市"},{value:"滨州",label:"滨州市"},{value:"菏泽",label:"菏泽市"}],"陕西":[{value:"西安",label:"西安市"},{value:"铜川",label:"铜川市"},{value:"宝鸡",label:"宝鸡市"},{value:"咸阳",label:"咸阳市"},{value:"渭南",label:"渭南市"},{value:"延安",label:"延安市"},{value:"汉中",label:"汉中市"},{value:"榆林",label:"榆林市"},{value:"安康",label:"安康市"},{value:"商洛",label:"商洛市"}],"甘肃":[{value:"兰州",label:"兰州市"},{value:"嘉峪关",label:"嘉峪关市"},{value:"金昌",label:"金昌市"},{value:"白银",label:"白银市"},{value:"天水",label:"天水市"},{value:"武威",label:"武威市"},{value:"张掖",label:"张掖市"},{value:"平凉",label:"平凉市"},{value:"酒泉",label:"酒泉市"},{value:"庆阳",label:"庆阳市"},{value:"定西",label:"定西市"},{value:"陇南",label:"陇南市"},{value:"临夏",label:"临夏回族自治州"},{value:"甘南",label:"甘南藏族自治州"}]},regionRules:[]}},computed:{currentUserId(){return localStorage.getItem("currentUserId")},filteredChannels(){if(!this.searchQuery)return this.channels;const e=this.searchQuery.toLowerCase();return this.channels.filter(a=>{const t={id:a.id,type:a.type,name:a.name,identifier:a.identifier,status:a.status};return Object.values(t).some(a=>String(a).toLowerCase().includes(e))})},selectedProvinces(){return this.provinces.filter(e=>this.currentChannel.regionBlacklist.provinces.includes(e.value))},hasBlockedRegions(){return this.currentChannel.regionBlacklist.provinces.length>0||this.currentChannel.regionBlacklist.cities.length>0},availableProvinces(){return this.provinces},...Object(n["e"])(i["a"],["domains"])},watch:{"currentChannel.regionBlacklist.enabled"(e){e&&0===this.regionRules.length&&this.addRule()}},methods:{...Object(n["d"])(i["a"],["fetchDomains"]),async loadChannels(){try{this.loading=!0,this.error=null;const e=await this.$api.get("/api/channels");this.channels=e.data.map(e=>{const a={...e,customParams:e.customParams||{userId:"",name:e.name,identifier:e.identifier},announcement:e.announcement||{enabled:!1,content:""},shareBlacklist:e.shareBlacklist||{enabled:!1,excludedUsers:[]},regionBlacklist:e.regionBlacklist||{enabled:!1,provinces:[],cities:[]},chatFeature:e.chatFeature||{enabled:!1}};return a})}catch(t){var e,a;console.error("Load channels error:",t),this.error=(null===(e=t.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"加载通道失败"}finally{this.loading=!1}},async generateQR(e){try{const a=localStorage.getItem("currentUserId");if(!a)return void this.$message.error("请先登录");if(!this.selectedDomain&&this.domains&&this.domains.length>0&&(this.selectedDomain=this.domains[0].name),!this.selectedDomain)return this.modalType="qr",this.currentChannel={...e},this.showModal=!0,this.modalMessage="请先在系统管理中添加域名",void(this.qrCodeUrl="");const l=this.selectedDomain,s=`${l}/#/payment?userId=${encodeURIComponent(a)}&channelId=${encodeURIComponent(e.identifier)}`;this.currentChannel={...e},this.modalType="qr",this.showModal=!0,this.modalMessage="支付链接: "+s;const n=await t.e("chunk-bbd28b8e").then(t.t.bind(null,"d055",7)),i=document.createElement("canvas");i.width=200,i.height=200,await new Promise((e,a)=>{n.toCanvas(i,s,{width:200,margin:0,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"}},t=>{t?a(t):e()})});const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{try{const e=document.createElement("canvas"),a=e.getContext("2d"),t=400;let l=r.width,s=r.height;if(l>t){const e=t/l;l=t,s=r.height*e}e.width=l,e.height=s,a.drawImage(r,0,0,l,s);const n=.17,o=.21,c=.65,u=.44,d=l*n,v=s*o,m=l*c,h=s*u,b=Math.min(m,h),p=d+(m-b)/2,f=v+(h-b)/2;a.drawImage(i,p,f,b,b),a.shadowColor="transparent",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0,this.qrCodeUrl=e.toDataURL("image/png")}catch(e){console.error("Canvas绘制失败:",e),this.qrCodeUrl=i.toDataURL("image/png")}},r.onerror=()=>{console.error("加载模板图片失败"),this.qrCodeUrl=i.toDataURL("image/png")},r.src="/images/h8.png"}catch(a){console.error("生成二维码失败:",a),this.$message.error("生成二维码失败")}},openSettings(e){this.modalType="settings",this.currentChannel=JSON.parse(JSON.stringify(e)),this.currentChannel.customParams||this.$set(this.currentChannel,"customParams",{}),this.currentChannel.announcement||this.$set(this.currentChannel,"announcement",{enabled:!1,content:""}),this.currentChannel.shareBlacklist||this.$set(this.currentChannel,"shareBlacklist",{enabled:!1}),this.currentChannel.regionBlacklist||this.$set(this.currentChannel,"regionBlacklist",{enabled:!1,provinces:[],cities:[]}),this.currentChannel.chatFeature||this.$set(this.currentChannel,"chatFeature",{enabled:!1}),this.currentChannel.nameRequired||this.$set(this.currentChannel,"nameRequired",{enabled:!1}),this.activeTab="basic",this.showModal=!0,this.regionRules=[]},async saveSettings(){try{this.isSaving=!0;const e={status:this.currentChannel.status,customParams:this.currentChannel.customParams,announcement:this.currentChannel.announcement,shareBlacklist:this.currentChannel.shareBlacklist,regionBlacklist:this.currentChannel.regionBlacklist,chatFeature:this.currentChannel.chatFeature,nameRequired:this.currentChannel.nameRequired,minAmount:this.currentChannel.minAmount,maxAmount:this.currentChannel.maxAmount};await this.$api.put(`/api/channels/${this.currentChannel._id}/settings`,e),this.$message.success("设置保存成功"),this.closeModal(),this.loadChannels()}catch(t){var e,a;this.$message.error((null===(e=t.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"保存失败")}finally{this.isSaving=!1}},closeModal(){this.showModal=!1,this.modalType="",this.qrCodeUrl="",this.modalMessage=""},async toggleStatus(e){try{var a;const t="启用"===e.status?"未启用":"启用",l={status:t,customParams:{...e.customParams,userId:(null===(a=e.customParams)||void 0===a?void 0:a.userId)||"",name:e.name,identifier:e.identifier}},s=await this.$api.put(`/api/channels/${e._id}/settings`,l),n=s.data.channel,i=this.channels.findIndex(e=>e._id===n._id);-1!==i&&this.$set(this.channels,i,{...this.channels[i],...n}),this.$message.success("通道已"+t)}catch(s){var t,l;this.$message.error("更新状态失败："+((null===(t=s.response)||void 0===t||null===(l=t.data)||void 0===l?void 0:l.message)||"未知错误")),e.status="启用"===e.status?"未启用":"启用"}},checkMobile(){this.isMobile=window.innerWidth<=768},isPaymentChannel(e){return e.includes("超科信安")||e.includes("小浪人")},initRegionRules(){this.regionRules=[];const{provinces:e,cities:a}=this.currentChannel.regionBlacklist;e.forEach(e=>{const t={province:e,cities:a.filter(a=>this.getCitiesByProvince(e).some(e=>e.value===a))};this.regionRules.push(t)}),0===this.regionRules.length&&this.currentChannel.regionBlacklist.enabled&&this.regionRules.push({province:"",cities:[]}),this.$forceUpdate()},addRule(){this.regionRules.push({province:"",cities:[]}),this.$nextTick(()=>{this.syncRegionBlacklist()})},removeRule(e){this.regionRules.splice(e,1),this.syncRegionBlacklist()},handleProvinceChange(e,a){this.regionRules[a].cities=[],this.$nextTick(()=>{this.syncRegionBlacklist()})},getCitiesByProvince(e){return this.cities[e]||[]},getProvinceLabel(e){const a=this.provinces.find(a=>a.value===e);return a?a.label:e},getCityLabel(e,a){if(!a||!e)return"";const t=this.cities[a];if(!t)return e;const l=t.find(a=>a.value===e);return l?l.label:e},removeProvince(e){const a=this.currentChannel.regionBlacklist.provinces.indexOf(e);if(-1!==a){var t;this.currentChannel.regionBlacklist.provinces.splice(a,1);const l=(null===(t=this.provinces.find(a=>a.value===e))||void 0===t?void 0:t.cities.map(e=>e.value))||[];this.currentChannel.regionBlacklist.cities=this.currentChannel.regionBlacklist.cities.filter(e=>!l.includes(e))}},removeCity(e){const a=this.currentChannel.regionBlacklist.cities.indexOf(e);-1!==a&&this.currentChannel.regionBlacklist.cities.splice(a,1)},convertRulesToBlacklist(){const e=[],a=[];return this.regionRules.forEach(t=>{t.province&&(t.cities&&t.cities.length>0?(e.push(t.province),a.push(...t.cities),["北京","天津","上海","重庆"].includes(t.province)&&a.push(t.province)):e.push(t.province))}),{enabled:this.currentChannel.regionBlacklist.enabled,provinces:[...new Set(e)],cities:[...new Set(a)]}},validateRegionRule(e){e.province&&!e.city&&this.$notify({title:"提示",message:"已设置禁用整个"+e.province,type:"warning",duration:2e3})},handleShareBlacklistChange(){this.$forceUpdate()},toggleViewMode(){this.viewMode="card"===this.viewMode?"table":"card",localStorage.setItem("channelViewMode",this.viewMode)},syncRegionBlacklist(){const e=[],a=[];this.regionRules.forEach(t=>{t.province&&(t.cities&&t.cities.length>0?(e.push(t.province),a.push(...t.cities),["北京","天津","上海","重庆"].includes(t.province)&&a.push(t.province)):e.push(t.province))}),this.currentChannel.regionBlacklist={enabled:this.currentChannel.regionBlacklist.enabled,provinces:[...new Set(e)],cities:[...new Set(a)]}},findProvinceByCity(e){for(const t of this.provinces){var a;if(null!==(a=this.cities[t.value])&&void 0!==a&&a.some(a=>a.value===e))return t.value}return""},handleCitiesChange(){this.$nextTick(()=>{this.syncRegionBlacklist()})},saveQRCode(){try{const e=document.createElement("a");e.href=this.qrCodeUrl,e.download=`channel_qrcode_${this.currentChannel.id||"download"}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e),this.$message&&this.$message.success("二维码下载成功")}catch(e){console.error("下载二维码失败:",e),this.$message&&this.$message.error("下载二维码失败，请重试")}},getHeaderIcon(e){switch(e){case"ID":return"fas fa-hashtag";case"通道类型":return"fas fa-tag";case"通道名称":return"fas fa-font";case"通道标识":return"fas fa-fingerprint";case"添加时间":return"fas fa-calendar-alt";case"在线人数":return"fas fa-users";case"累计金额":return"fas fa-money-bill-wave";case"操作":return"fas fa-cog";case"状态":return"fas fa-circle";default:return""}},getChannelTypeIcon(e){switch(e){case"云闪付":return"fas fa-bolt";case"银联":return"fas fa-credit-card";default:return"fas fa-credit-card"}},getChannelTypeBadgeClass(e){switch(e){case"微信":return"type-badge-wechat";case"支付宝":return"type-badge-alipay";case"云闪付":return"type-badge-cloudpay";case"银联":return"type-badge-unionpay";default:return""}}},mounted(){this.checkMobile(),window.addEventListener("resize",this.checkMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkMobile)},async created(){this.loadChannels(),this.fetchDomains(),this.checkMobile(),window.addEventListener("resize",this.checkMobile)},destroyed(){window.removeEventListener("resize",this.checkMobile)}},o=r,c=(t("c3a6"),t("2877")),u=Object(c["a"])(o,l,s,!1,null,"1395a1b0",null);a["a"]=u.exports},"4e93":function(e,a,t){"use strict";var l=function(){var e=this,a=e._self._c;return a("div",{staticClass:"global-notifications"},[a("transition-group",{attrs:{name:"notification"}},e._l(e.notifications,(function(t){return a("div",{key:t.id,staticClass:"notification-item",on:{click:function(a){return e.handleNotificationClick(t)}}},[a("div",{staticClass:"notification-content"},[a("i",{staticClass:"fas fa-comment"}),a("div",{staticClass:"notification-text"},[a("div",{staticClass:"notification-title"},[e._v("新消息提醒")]),a("div",{staticClass:"notification-message"},[e._v(" 订单 "+e._s(t.displayId)+": "+e._s(t.message)+" ")])]),a("button",{staticClass:"close-btn",on:{click:function(a){return a.stopPropagation(),e.removeNotification(t.id)}}},[a("i",{staticClass:"fas fa-times"})])])])})),0)],1)},s=[],n=(t("14d9"),t("1e70"),t("79a4"),t("c1a1"),t("8b00"),t("a4e7"),t("1e5a"),t("72c3"),t("0643"),t("2382"),t("4e3e"),{name:"GlobalMessageListener",data(){return{notificationSound:null,socketInitialized:!1,processedMessageIds:new Set,notifications:[],activeChatOrders:new Set}},methods:{initSocket(){if(this.socketInitialized)return;if(!this.$socket)return void console.error("Socket not initialized");const e=localStorage.getItem("currentUserId"),a=localStorage.getItem("userRole");this.$socket.emit("join-chat",{userId:e}),this.$socket.off("merchantMessage"),this.$socket.on("merchantMessage",t=>{if(this.processedMessageIds.has(t.message._id))return;this.processedMessageIds.add(t.message._id);const l=t.orderUserId===e,s="superadmin"===a;if(s||l){const e=!this.activeChatOrders.has(t.orderId);if(this.playNotificationSound(),e){const e={id:Date.now()+Math.random(),orderId:t.orderId,displayId:t.orderId.slice(-8),message:t.message.content,timestamp:new Date,removing:!1};if(this.notifications.unshift(e),this.notifications.length>5){const e=this.notifications.slice(5);this.notifications=this.notifications.slice(0,5),e.forEach(e=>{e.removing=!0})}setTimeout(()=>{this.removeNotification(e.id)},5e3)}this.$root.$emit("new-chat-message",{orderId:t.orderId,message:t.message,isOwner:l})}}),this.socketInitialized=!0},playNotificationSound(){this.notificationSound&&(this.notificationSound.currentTime=0,this.notificationSound.play().catch(e=>{console.warn("Failed to play notification sound:",e)}))},addNotification(e){const a=Date.now()+Math.random();this.notifications.unshift({id:a,orderId:e.orderId,displayId:e.displayId||e.orderId.slice(-8),message:e.message,timestamp:new Date}),this.notifications.length>5&&(this.notifications=this.notifications.slice(0,5)),setTimeout(()=>{this.removeNotification(a)},5e3)},removeNotification(e){const a=this.notifications.findIndex(a=>a.id===e);-1!==a&&(this.$set(this.notifications[a],"removing",!0),setTimeout(()=>{this.notifications=this.notifications.filter(a=>a.id!==e)},300))},handleNotificationClick(e){e&&e.orderId&&(this.$router.push({path:"/order-query",query:{orderId:e.orderId}}),this.removeNotification(e.id))},handleChatWindowState(e,a){a?this.activeChatOrders.add(e):this.activeChatOrders.delete(e)}},mounted(){this.notifications=[],localStorage.getItem("isLoggedIn")&&(this.initSocket(),this.notificationSound=new Audio("/jhm/notification.mp3"),this.notificationSound.load(),"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission(),this.$root.$on("chat-window-state",this.handleChatWindowState))},beforeDestroy(){if(this.$socket){const e=localStorage.getItem("currentUserId");this.$socket.emit("leave-chat",{userId:e}),this.$socket.off("merchantMessage"),this.socketInitialized=!1}this.$root.$off("chat-window-state",this.handleChatWindowState)}}),i=n,r=(t("8903"),t("2877")),o=Object(r["a"])(i,l,s,!1,null,"7a7f13ca",null);a["a"]=o.exports},"66d9":function(e,a,t){},8903:function(e,a,t){"use strict";t("b97c")},"8f1f":function(e,a,t){e.exports=t.p+"jhm/img/logo1.22335af8.png"},a347:function(e,a,t){},b670:function(e,a,t){"use strict";var l=function(){var e=this,a=e._self._c;return a("div",{staticClass:"customer-service"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showChat,expression:"showChat"}],staticClass:"chat-window"},[a("div",{staticClass:"chat-header"},[e._m(0),a("button",{staticClass:"close-btn",attrs:{title:"关闭"},on:{click:e.closeChat}},[a("i",{staticClass:"fas fa-times"})])]),a("div",{ref:"messageContainer",staticClass:"chat-messages"},e._l(e.messages,(function(t){return a("div",{key:t._id,class:["message",e.getMessageClass(t)]},[e.showSenderInfo(t)?a("div",{staticClass:"sender-info"},[e._v(" "+e._s(e.getSenderLabel(t))+" ")]):e._e(),a("div",{staticClass:"message-content"},["image"===t.type?[a("img",{attrs:{src:t.content,alt:"聊天图片"},on:{click:function(a){e.previewImage=t.content}}})]:[e._v(" "+e._s(t.content)+" ")]],2),a("div",{staticClass:"message-time"},[e._v(e._s(e.formatTime(t.createdAt)))])])})),0),a("div",{staticClass:"chat-input"},[e.showEmojiPicker?a("div",{staticClass:"emoji-picker"},[a("div",{staticClass:"emoji-container"},e._l(e.emojis,(function(t){return a("span",{key:t,staticClass:"emoji-item",on:{click:function(a){return e.insertEmoji(t)}}},[e._v(e._s(t))])})),0)]):e._e(),a("div",{staticClass:"input-toolbar"},[a("button",{staticClass:"tool-btn",on:{click:e.toggleEmojiPicker}},[a("i",{staticClass:"far fa-smile"})]),a("label",{staticClass:"tool-btn"},[a("i",{staticClass:"far fa-image"}),a("input",{staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:e.handleImageUpload}})])]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newMessage,expression:"newMessage"}],ref:"messageInput",attrs:{placeholder:"输入消息..."},domProps:{value:e.newMessage},on:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.sendMessage.apply(null,arguments)},input:function(a){a.target.composing||(e.newMessage=a.target.value)}}}),a("button",{attrs:{disabled:!e.canSendMessage},on:{click:function(a){return a.stopPropagation(),e.sendMessage()}}},[a("i",{staticClass:"fas fa-paper-plane"})])])]),e.previewImage?a("div",{staticClass:"image-preview-modal",on:{click:e.closePreview}},[a("div",{staticClass:"preview-content",on:{click:function(e){e.stopPropagation()}}},[a("img",{attrs:{src:e.previewImage,alt:"预览图片"}}),a("div",{staticClass:"preview-actions"},[a("button",{staticClass:"cancel-btn",on:{click:e.closePreview}},[e._v("取消")]),a("button",{staticClass:"send-btn",on:{click:e.sendImage}},[e._v("发送")])])])]):e._e()])},s=[function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-content"},[a("i",{staticClass:"fas fa-headset header-icon"}),a("span",{staticClass:"header-title"},[e._v("客户支持")])])}],n=(t("14d9"),t("1e70"),t("79a4"),t("c1a1"),t("8b00"),t("a4e7"),t("1e5a"),t("72c3"),t("88a7"),t("271a"),t("5494"),{name:"CustomerService",props:{orderId:{type:String,required:!0}},data(){return{showChat:!0,messages:[],newMessage:"",unreadCount:0,socketInitialized:!1,isLoading:!1,localMessages:[],processedMessageIds:new Set,orderInfo:null,notificationSound:null,showEmojiPicker:!1,emojis:["😊","😂","🤔","👍","❤️","😭","🎉","🌟","💪","🙏"],previewImage:null,imageFile:null,uploadingImage:!1}},computed:{canSendMessage(){return!this.uploadingImage&&(this.newMessage.trim()||this.imageFile)}},methods:{closeChat(){this.$emit("chat-closed")},initSocket(){this.socketInitialized||(this.$socket?(this.$socket.emit("join-chat",{room:"order:"+this.orderId,userId:localStorage.getItem("currentUserId")}),this.$socket.on("newMessage",e=>{this.processedMessageIds.has(e.message._id)||(this.processedMessageIds.add(e.message._id),this.messages.push(e.message),this.$nextTick(()=>{this.scrollToBottom()}))}),this.socketInitialized=!0):console.error("Socket not initialized"))},async loadMessages(){if(!this.isLoading)try{this.isLoading=!0;const e=await this.$api.get("/api/messages/"+this.orderId);this.messages=e.data,this.$nextTick(()=>{this.scrollToBottom()})}catch(e){console.error("Load messages error:",e)}finally{this.isLoading=!1}},async sendMessage(e=null){if((this.newMessage.trim()||e)&&this.orderId)try{const a={content:e||this.newMessage.trim(),type:e?"image":"text",sender:"merchant"},t=await this.$api.post("/api/messages/"+this.orderId,a);t.data&&(e||(this.newMessage=""),this.processedMessageIds.has(t.data._id)||(this.processedMessageIds.add(t.data._id),this.messages.push(t.data)),this.$nextTick(()=>{this.scrollToBottom()}))}catch(a){console.error("Send message error:",a)}},formatTime(e){return new Date(e).toLocaleTimeString()},scrollToBottom(){this.$refs.messageContainer&&(this.$refs.messageContainer.scrollTop=this.$refs.messageContainer.scrollHeight)},getMessageClass(e){return this.isMerchant()?"merchant"===e.sender?"sent":"received":"user"===e.sender?"sent":"received"},showSenderInfo(e){return"merchant"===e.sender||"user"===e.sender},getSenderLabel(e){return this.isMerchant()?"merchant"===e.sender?"商家":"客户":"user"===e.sender?"我":"商家"},async fetchOrderInfo(){try{const e=await this.$api.get("/api/orders/"+this.orderId);this.orderInfo=e.data}catch(e){console.error("获取订单信息失败:",e)}},isMerchant(){const e=localStorage.getItem("currentUserId"),a=localStorage.getItem("userRole");return"superadmin"===a||this.orderInfo&&this.orderInfo.userId===e},playNotificationSound(){this.notificationSound||(this.notificationSound=new Audio("/notification.mp3")),this.notificationSound.play().catch(e=>{console.warn("Failed to play notification sound:",e)})},showSystemNotification(e,a){if(!("Notification"in window)||"granted"!==Notification.permission)return;const t=new Notification("新消息提醒",{body:e,icon:"/favicon.ico",tag:"chat-"+a,requireInteraction:!0,silent:!0});t.onclick=()=>{window.focus(),this.showChat=!0,this.$router.push({path:"/order-query",query:{orderId:a}}),t.close()},setTimeout(()=>{t.close()},1e4)},toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker},insertEmoji(e){this.newMessage+=e,this.$refs.messageInput.focus()},async handleImageUpload(e){const a=e.target.files[0];if(a)if(a.type.startsWith("image/"))if(a.size>5242880)this.$message.error("图片大小不能超过5MB");else try{const e=new FormData;e.append("image",a);const t=await this.$api.post("/api/messages/upload-image",e,{headers:{"Content-Type":"multipart/form-data"}});t.data.imageUrl&&await this.sendMessage(t.data.imageUrl)}catch(t){console.error("Upload image error:",t),this.$message.error("图片上传失败")}else this.$message.error("请选择图片文件")},closePreview(){this.previewImage&&URL.revokeObjectURL(this.previewImage),this.previewImage=null,this.imageFile=null},async sendImage(){if(this.imageFile&&!this.uploadingImage)try{this.uploadingImage=!0;const e=new FormData;e.append("image",this.imageFile),e.append("orderId",this.orderId);const a=await this.$api.post("/api/messages/upload-image",e,{headers:{"Content-Type":"multipart/form-data"}});await this.sendMessage(a.data.imageUrl),this.closePreview()}catch(e){console.error("Upload image error:",e),this.$message.error("图片上传失败")}finally{this.uploadingImage=!1}},reopenChat(){this.showChat=!0,this.unreadCount=0,this.$nextTick(()=>{this.scrollToBottom()})},sendNotification(e){this.$root.$emit("new-chat-notification",{orderId:e.orderId,message:e.message.content,displayId:e.orderId.slice(-8)}),this.showSystemNotification(e.message.content,e.orderId)}},watch:{localMessages:{deep:!0,handler(){this.$nextTick(()=>{this.scrollToBottom()})}},orderId:{immediate:!0,handler(e,a){e!==a&&(this.$socket&&a&&(this.$socket.off("newMessage"),this.$socket.emit("leave-chat",{room:"order:"+a,userId:localStorage.getItem("currentUserId")})),this.messages=[],this.processedMessageIds.clear(),this.socketInitialized=!1,e&&(this.initSocket(),this.loadMessages()))}},"$route.query.orderId":{handler(e){this.orderId},immediate:!0}},async mounted(){this.orderId&&(this.initSocket(),await this.loadMessages())},beforeDestroy(){this.$socket&&(this.$socket.off("newMessage"),this.$socket.emit("leave-chat",{room:"order:"+this.orderId,userId:localStorage.getItem("currentUserId")}))}}),i=n,r=(t("0194"),t("2877")),o=Object(r["a"])(i,l,s,!1,null,"2c1d0018",null);a["a"]=o.exports},b97c:function(e,a,t){},c3a6:function(e,a,t){"use strict";t("66d9")},fabc:function(e,a,t){}}]);
//# sourceMappingURL=app~f71cff67.046bce42.js.map
