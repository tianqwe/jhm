(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a9adcdf0"],{"18d4":function(t,s,e){},"76d6":function(t,s,e){"use strict";e("d866")},a65f:function(t,s,e){"use strict";e("18d4")},ce32:function(t,s,e){"use strict";e.r(s);e("a573");var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"recharge-cards"},[s("div",{staticClass:"stats-grid"},[s("div",{staticClass:"stat-card"},[t._m(0),s("div",{staticClass:"stat-content"},[s("span",{staticClass:"stat-label"},[t._v("总卡密数")]),s("span",{staticClass:"stat-value"},[t._v(t._s(t.cards.length))])])]),s("div",{staticClass:"stat-card"},[t._m(1),s("div",{staticClass:"stat-content"},[s("span",{staticClass:"stat-label"},[t._v("未使用")]),s("span",{staticClass:"stat-value"},[t._v(t._s(t.unusedCount))])])]),s("div",{staticClass:"stat-card"},[t._m(2),s("div",{staticClass:"stat-content"},[s("span",{staticClass:"stat-label"},[t._v("总金额")]),s("span",{staticClass:"stat-value"},[t._v("¥"+t._s(t.formatAmount(t.totalAmount)))])])])]),s("div",{staticClass:"toolbar"},[s("div",{staticClass:"toolbar-left"},[s("div",{staticClass:"search-box"},[s("i",{staticClass:"fas fa-search"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchQuery,expression:"searchQuery"}],attrs:{placeholder:"搜索卡号..."},domProps:{value:t.searchQuery},on:{input:function(s){s.target.composing||(t.searchQuery=s.target.value)}}})])]),s("div",{staticClass:"toolbar-right"},[s("div",{staticClass:"filters"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.statusFilter,expression:"statusFilter"}],on:{change:function(s){var e=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var s="_value"in t?t._value:t.value;return s}));t.statusFilter=s.target.multiple?e:e[0]}}},[s("option",{attrs:{value:"all"}},[t._v("全部状态")]),s("option",{attrs:{value:"unused"}},[t._v("未使用")]),s("option",{attrs:{value:"used"}},[t._v("已使用")])]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.sortBy,expression:"sortBy"}],on:{change:function(s){var e=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var s="_value"in t?t._value:t.value;return s}));t.sortBy=s.target.multiple?e:e[0]}}},[s("option",{attrs:{value:"createdAt"}},[t._v("创建时间")]),s("option",{attrs:{value:"amount"}},[t._v("金额")]),s("option",{attrs:{value:"status"}},[t._v("状态")])]),s("button",{staticClass:"sort-btn",on:{click:t.toggleSortOrder}},[s("i",{class:"asc"===t.sortOrder?"fas fa-sort-amount-up":"fas fa-sort-amount-down"})])]),s("div",{staticClass:"actions"},[s("button",{staticClass:"action-btn danger",attrs:{disabled:0===t.selectedCards.length},on:{click:t.confirmBatchDelete}},[s("i",{staticClass:"fas fa-trash-alt"}),t._v(" 批量删除 ")]),s("button",{staticClass:"action-btn",attrs:{disabled:0===t.selectedCards.length},on:{click:t.exportSelected}},[s("i",{staticClass:"fas fa-file-export"}),t._v(" 导出选中 ")])])])]),s("div",{staticClass:"cards-list"},[t.isMobile?s("div",{staticClass:"mobile-cards"},t._l(t.filteredCards,(function(e){var a;return s("div",{key:e.cardNo,staticClass:"card-item"},[s("div",{staticClass:"card-header"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedCards,expression:"selectedCards"}],attrs:{type:"checkbox",disabled:"used"===e.status},domProps:{value:e.cardNo,checked:Array.isArray(t.selectedCards)?t._i(t.selectedCards,e.cardNo)>-1:t.selectedCards},on:{change:function(s){var a=t.selectedCards,i=s.target,c=!!i.checked;if(Array.isArray(a)){var r=e.cardNo,l=t._i(a,r);i.checked?l<0&&(t.selectedCards=a.concat([r])):l>-1&&(t.selectedCards=a.slice(0,l).concat(a.slice(l+1)))}else t.selectedCards=c}}}),s("span",{class:["status-badge","used"===e.status?"used":"unused"]},[t._v(" "+t._s("used"===e.status?"已使用":"未使用")+" ")])]),s("div",{staticClass:"card-body"},[s("div",{staticClass:"card-row"},[s("span",{staticClass:"label"},[t._v("卡号:")]),s("div",{staticClass:"card-no"},[t._v(" "+t._s(e.cardNo)+" "),s("button",{staticClass:"copy-btn",on:{click:function(s){return t.copyCardNo(e.cardNo)}}},[s("i",{staticClass:"fas fa-copy"})])])]),s("div",{staticClass:"card-row"},[s("span",{staticClass:"label"},[t._v("金额:")]),s("span",{staticClass:"value"},[t._v("¥"+t._s(t.formatAmount(e.amount)))])]),s("div",{staticClass:"card-row"},[s("span",{staticClass:"label"},[t._v("生成时间:")]),s("span",{staticClass:"value"},[t._v(t._s(t.formatDate(e.createdAt)))])]),"used"===e.status?s("div",{staticClass:"card-row"},[s("span",{staticClass:"label"},[t._v("使用时间:")]),s("span",{staticClass:"value"},[t._v(t._s(t.formatDate(e.usedAt)))])]):t._e(),"used"===e.status?s("div",{staticClass:"card-row"},[s("span",{staticClass:"label"},[t._v("使用者:")]),s("span",{staticClass:"value"},[t._v(t._s((null===(a=e.usedBy)||void 0===a?void 0:a.username)||"-"))])]):t._e()]),"used"!==e.status?s("div",{staticClass:"card-footer"},[s("button",{staticClass:"delete-btn",on:{click:function(s){return t.confirmDelete(e)}}},[s("i",{staticClass:"fas fa-trash-alt"}),t._v(" 删除 ")])]):t._e()])})),0):s("div",{staticClass:"table-wrapper"},[s("table",[s("thead",[s("tr",[s("th",{staticStyle:{width:"40px"}},[s("input",{attrs:{type:"checkbox"},domProps:{checked:t.isAllSelected},on:{change:t.toggleSelectAll}})]),s("th",[t._v("卡号")]),s("th",{staticStyle:{width:"100px"}},[t._v("金额")]),s("th",{staticStyle:{width:"100px"}},[t._v("状态")]),s("th",{staticStyle:{width:"180px"}},[t._v("生成时间")]),s("th",{staticStyle:{width:"180px"}},[t._v("使用时间")]),s("th",{staticStyle:{width:"120px"}},[t._v("使用者")]),s("th",{staticStyle:{width:"80px"}},[t._v("操作")])])]),s("tbody",t._l(t.filteredCards,(function(e){var a;return s("tr",{key:e.cardNo},[s("td",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedCards,expression:"selectedCards"}],attrs:{type:"checkbox",disabled:"used"===e.status},domProps:{value:e.cardNo,checked:Array.isArray(t.selectedCards)?t._i(t.selectedCards,e.cardNo)>-1:t.selectedCards},on:{change:function(s){var a=t.selectedCards,i=s.target,c=!!i.checked;if(Array.isArray(a)){var r=e.cardNo,l=t._i(a,r);i.checked?l<0&&(t.selectedCards=a.concat([r])):l>-1&&(t.selectedCards=a.slice(0,l).concat(a.slice(l+1)))}else t.selectedCards=c}}})]),s("td",[s("div",{staticClass:"card-no"},[t._v(" "+t._s(e.cardNo)+" "),s("button",{staticClass:"copy-btn",on:{click:function(s){return t.copyCardNo(e.cardNo)}}},[s("i",{staticClass:"fas fa-copy"})])])]),s("td",[t._v("¥"+t._s(t.formatAmount(e.amount)))]),s("td",[s("span",{class:["status-badge","used"===e.status?"used":"unused"]},[t._v(" "+t._s("used"===e.status?"已使用":"未使用")+" ")])]),s("td",[t._v(t._s(t.formatDate(e.createdAt)))]),s("td",[t._v(t._s(e.usedAt?t.formatDate(e.usedAt):"-"))]),s("td",[t._v(t._s((null===(a=e.usedBy)||void 0===a?void 0:a.username)||"-"))]),s("td",[s("button",{staticClass:"delete-btn",attrs:{disabled:"used"===e.status},on:{click:function(s){return t.confirmDelete(e)}}},[s("i",{staticClass:"fas fa-trash-alt"})])])])})),0)])]),0===t.filteredCards.length?s("div",{staticClass:"empty-state"},[s("i",{staticClass:"fas fa-ticket-alt"}),s("p",[t._v("暂无卡密数据")])]):t._e()]),t.showDeleteModal?s("div",{staticClass:"modal-overlay",on:{click:t.closeDeleteModal}},[s("div",{staticClass:"modal delete-modal",on:{click:function(t){t.stopPropagation()}}},[s("div",{staticClass:"modal-header"},[s("h3",[t._v(t._s(t.isBatchDelete?"批量删除卡密":"删除卡密"))]),s("button",{staticClass:"close-btn",on:{click:t.closeDeleteModal}},[s("i",{staticClass:"fas fa-times"})])]),s("div",{staticClass:"modal-content"},[s("p",{staticClass:"warning-text"},[s("i",{staticClass:"fas fa-exclamation-triangle"}),t._v(" "+t._s(t.isBatchDelete?`确定要删除选中的 ${t.selectedCards.length} 个未使用卡密吗？`:"确定要删除这个未使用的卡密吗？")+" ")]),s("p",{staticClass:"sub-warning"},[t._v("此操作不可恢复")])]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"cancel-btn",on:{click:t.closeDeleteModal}},[t._v("取消")]),s("button",{staticClass:"confirm-btn danger",attrs:{disabled:t.deleteLoading},on:{click:t.deleteCards}},[t.deleteLoading?[s("i",{staticClass:"fas fa-spinner fa-spin"}),t._v(" 删除中... ")]:[s("i",{staticClass:"fas fa-trash-alt"}),t._v(" 确认删除 ")]],2)])])]):t._e()])},i=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"stat-icon"},[s("i",{staticClass:"fas fa-ticket-alt"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"stat-icon"},[s("i",{staticClass:"fas fa-check-circle"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"stat-icon"},[s("i",{staticClass:"fas fa-coins"})])}],c=(e("13d5"),e("0643"),e("76d6"),e("2382"),e("9d4a"),e("88a7"),e("271a"),e("5494"),{name:"RechargeCards",data(){return{cards:[],searchQuery:"",statusFilter:"all",sortBy:"createdAt",sortOrder:"desc",selectedCards:[],showDeleteModal:!1,cardToDelete:null,deleteLoading:!1,isBatchDelete:!1,isMobile:!1}},computed:{unusedCount(){return this.cards.filter(t=>"unused"===t.status).length},totalAmount(){return this.cards.reduce((t,s)=>t+s.amount,0)},filteredCards(){let t=[...this.cards];return this.searchQuery&&(t=t.filter(t=>t.cardNo.toLowerCase().includes(this.searchQuery.toLowerCase()))),"all"!==this.statusFilter&&(t=t.filter(t=>t.status===this.statusFilter)),t.sort((t,s)=>{let e;switch(this.sortBy){case"amount":e=t.amount-s.amount;break;case"status":e=t.status.localeCompare(s.status);break;default:e=new Date(t.createdAt)-new Date(s.createdAt)}return"asc"===this.sortOrder?e:-e}),t},isAllSelected(){const t=this.filteredCards.filter(t=>"unused"===t.status);return t.length>0&&t.every(t=>this.selectedCards.includes(t.cardNo))}},methods:{async loadCards(){try{const t=await this.$api.get("/api/recharge-cards");this.cards=t.data}catch(t){this.$message.error("加载卡密列表失败")}},copyCardNo(t){navigator.clipboard.writeText(t).then(()=>this.$message.success("卡号已复制")).catch(()=>this.$message.error("复制失败"))},confirmDelete(t){"used"!==t.status&&(this.cardToDelete=t,this.showDeleteModal=!0)},async deleteCards(){if(!this.deleteLoading)try{this.deleteLoading=!0;const t=this.isBatchDelete?this.selectedCards:[this.cardToDelete.cardNo];await this.$api.post("/api/recharge-cards/delete",{cardNos:t}),this.$message.success(this.isBatchDelete?"批量删除成功":"删除卡密成功"),await this.loadCards(),this.selectedCards=[],this.closeDeleteModal()}catch(e){var t,s;this.$message.error((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"删除失败")}finally{this.deleteLoading=!1}},formatAmount(t){return parseFloat(t).toFixed(2)},formatDate(t){return new Date(t).toLocaleString()},closeDeleteModal(){this.showDeleteModal=!1,this.cardToDelete=null},toggleSelectAll(){this.isAllSelected?this.selectedCards=[]:this.selectedCards=this.filteredCards.filter(t=>"unused"===t.status).map(t=>t.cardNo)},toggleSortOrder(){this.sortOrder="asc"===this.sortOrder?"desc":"asc"},confirmBatchDelete(){this.isBatchDelete=!0,this.showDeleteModal=!0},exportSelected(){const t=this.cards.filter(t=>this.selectedCards.includes(t.cardNo)),s=[["卡号","金额","状态","生成时间"].join(","),...t.map(t=>[t.cardNo,this.formatAmount(t.amount),"unused"===t.status?"未使用":"已使用",new Date(t.createdAt).toLocaleString()].join(","))].join("\n"),e=new Blob(["\ufeff"+s],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(e),i=document.createElement("a");i.setAttribute("href",a),i.setAttribute("download",`选中卡密_${(new Date).toLocaleDateString()}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)},checkMobile(){this.isMobile=window.innerWidth<=768}},created(){this.loadCards(),this.checkMobile(),window.addEventListener("resize",this.checkMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkMobile)}}),r=c,l=(e("a65f"),e("2877")),d=Object(l["a"])(r,a,i,!1,null,"4ea77860",null);s["default"]=d.exports},d866:function(t,s,e){"use strict";var a=e("23e7"),i=e("2266"),c=e("59ed"),r=e("825a"),l=e("46c4");a({target:"Iterator",proto:!0,real:!0},{every:function(t){r(this),c(t);var s=l(this),e=0;return!i(s,(function(s,a){if(!t(s,e++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})}}]);
//# sourceMappingURL=chunk-a9adcdf0.e797ce0b.js.map