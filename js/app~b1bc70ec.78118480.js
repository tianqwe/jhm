(function(t){function s(s){for(var a,i,o=s[0],l=s[1],c=s[2],d=0,u=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);h&&h(s);while(u.length)u.shift()();return n.push.apply(n,c||[]),e()}function e(){for(var t,s=0;s<n.length;s++){for(var e=n[s],a=!0,i=1;i<e.length;i++){var o=e[i];0!==r[o]&&(a=!1)}a&&(n.splice(s--,1),t=l(l.s=e[0]))}return t}var a={},i={"app~b1bc70ec":0},r={"app~b1bc70ec":0},n=[];function o(t){return l.p+"js/"+({}[t]||t)+"."+{"chunk-48cb8296":"87c4e552","chunk-4d0e187a":"202bf6ba","chunk-6c161f2c":"0bd3b70c","chunk-a089fe48":"d30d739c","chunk-a9adcdf0":"50cf8275","chunk-bbd28b8e":"72837a9c","chunk-783e22ef":"e644c11f"}[t]+".js"}function l(s){if(a[s])return a[s].exports;var e=a[s]={i:s,l:!1,exports:{}};return t[s].call(e.exports,e,e.exports,l),e.l=!0,e.exports}l.e=function(t){var s=[],e={"chunk-48cb8296":1,"chunk-4d0e187a":1,"chunk-6c161f2c":1,"chunk-a089fe48":1,"chunk-a9adcdf0":1,"chunk-783e22ef":1};i[t]?s.push(i[t]):0!==i[t]&&e[t]&&s.push(i[t]=new Promise((function(s,e){for(var a="css/"+({}[t]||t)+"."+{"chunk-48cb8296":"cafee43b","chunk-4d0e187a":"4f532ef8","chunk-6c161f2c":"95205726","chunk-a089fe48":"14c92c37","chunk-a9adcdf0":"a102cc24","chunk-bbd28b8e":"31d6cfe0","chunk-783e22ef":"a8f290d6"}[t]+".css",r=l.p+a,n=document.getElementsByTagName("link"),o=0;o<n.length;o++){var c=n[o],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===a||d===r))return s()}var u=document.getElementsByTagName("style");for(o=0;o<u.length;o++){c=u[o],d=c.getAttribute("data-href");if(d===a||d===r)return s()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=s,h.onerror=function(s){var a=s&&s.target&&s.target.src||r,n=new Error("Loading CSS chunk "+t+" failed.\n("+a+")");n.code="CSS_CHUNK_LOAD_FAILED",n.request=a,delete i[t],h.parentNode.removeChild(h),e(n)},h.href=r;var f=document.getElementsByTagName("head")[0];f.appendChild(h)})).then((function(){i[t]=0})));var a=r[t];if(0!==a)if(a)s.push(a[2]);else{var n=new Promise((function(s,e){a=r[t]=[s,e]}));s.push(a[2]=n);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=o(t);var u=new Error;c=function(s){d.onerror=d.onload=null,clearTimeout(h);var e=r[t];if(0!==e){if(e){var a=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.src;u.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",u.name="ChunkLoadError",u.type=a,u.request=i,e[1](u)}r[t]=void 0}};var h=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(s)},l.m=t,l.c=a,l.d=function(t,s,e){l.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},l.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.t=function(t,s){if(1&s&&(t=l(t)),8&s)return t;if(4&s&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(l.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var a in t)l.d(e,a,function(s){return t[s]}.bind(null,a));return e},l.n=function(t){var s=t&&t.__esModule?function(){return t["default"]}:function(){return t};return l.d(s,"a",s),s},l.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},l.p="/",l.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=s,c=c.slice();for(var u=0;u<c.length;u++)s(c[u]);var h=d;n.push([0,"vendors~app~253ae210","vendors~app~7274e1de","vendors~app~b5906859","vendors~app~db300d2f","vendors~app~6ed3fd28","vendors~app~9ad0f35b","vendors~app~fe785c75","vendors~app~ce3ab05b","vendors~app~7bcc931c","vendors~app~1df1df2f","vendors~app~b58f7129","vendors~app~fdc6512a","vendors~app~d2305125","app~d0ae3f07","app~f71cff67","app~21833f8f","app~c714bc7b"]),e()})({"0a62":function(t,s,e){"use strict";var a=function(){var t=this;t._self._c;return t._m(0)},i=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"tool-download-container"},[s("div",{staticClass:"tool-header"},[s("div",{staticClass:"tool-title"},[s("h1",[t._v("半自动抓包工具下载（需配合面对面通道使用）")]),s("div",{staticClass:"tool-subtitle"},[t._v("羊先生抓包 高级网络抓包与自动化工具")])]),s("div",{staticClass:"tool-actions"},[s("a",{staticClass:"download-btn",attrs:{href:"https://xis.lanzouw.com/ixPSV2yrkoyh",target:"_blank"}},[s("i",{staticClass:"fas fa-download"}),s("span",[t._v("立即下载")])])])]),s("div",{staticClass:"tool-content"},[s("div",{staticClass:"content-section"},[s("h2",[t._v("工具说明")]),s("p",[t._v("羊先生抓包 是一款功能强大的网络抓包与自动化工具。它提供了一个现代化的图形用户界面（GUI），旨在帮助您捕获、检查、修改和分析计算机的网络流量，并能自动化处理特定的业务流程，尤其是在订单处理和数据提取方面功能强大。")])]),s("div",{staticClass:"content-section"},[s("h3",[t._v("主要特性")]),s("ul",{staticClass:"feature-list"},[s("li",[s("div",{staticClass:"feature-icon"},[s("i",{staticClass:"fas fa-wifi"})]),s("div",{staticClass:"feature-details"},[s("h4",[t._v("全面的网络抓包")]),s("p",[t._v("捕获您电脑的 HTTP/HTTPS 流量，支持实时查看请求和响应的详细数据。")])])]),s("li",[s("div",{staticClass:"feature-icon"},[s("i",{staticClass:"fas fa-cogs"})]),s("div",{staticClass:"feature-details"},[s("h4",[t._v("高级规则引擎")]),s("p",[t._v("您可以创建高度可定制的拦截规则，通过匹配网址（URL）来触发一系列自动化动作。")])])]),s("li",[s("div",{staticClass:"feature-icon"},[s("i",{staticClass:"fas fa-robot"})]),s("div",{staticClass:"feature-details"},[s("h4",[t._v("灵活的自动化动作")]),s("ul",[s("li",[t._v("修改与重定向: 拦截并修改网络请求/响应，或将其重定向到其他地址。")]),s("li",[t._v("数据提取与解析: 使用多种方式（如JSON Path, 正则表达式等）从网络响应内容中精确提取您需要的数据。")]),s("li",[t._v("二维码识别: 自动识别并解码来自网页、图片URL或本地文件中的二维码。")]),s("li",[t._v('业务流程自动化: 内置"发送到订单"等与特定业务逻辑相关的动作，极大简化重复性操作。')])])])]),s("li",[s("div",{staticClass:"feature-icon"},[s("i",{staticClass:"fas fa-list-alt"})]),s("div",{staticClass:"feature-details"},[s("h4",[t._v("订单管理系统")]),s("p",[t._v("集成了一个专门的订单管理面板，可以实时接收（通过WebSocket）、查看、搜索、管理和导出订单数据。")])])]),s("li",[s("div",{staticClass:"feature-icon"},[s("i",{staticClass:"fas fa-random"})]),s("div",{staticClass:"feature-details"},[s("h4",[t._v("多样的代理模式")]),s("p",[t._v('支持"全局代理"和更精准的"指定进程代理"（捕获特定软件的流量）。')])])]),s("li",[s("div",{staticClass:"feature-icon"},[s("i",{staticClass:"fas fa-paint-brush"})]),s("div",{staticClass:"feature-details"},[s("h4",[t._v("现代化UI")]),s("p",[t._v("界面美观、操作流畅。")])])])])]),s("div",{staticClass:"content-section"},[s("h2",[t._v("使用教程")]),s("div",{staticClass:"tutorial-section"},[s("h3",[t._v("1. 安装与运行")]),s("ul",[s("li",[s("strong",[t._v("环境要求:")]),t._v(" 本程序为绿色软件，无需安装。建议在 Windows 10 或更高版本的操作系统上运行。")]),s("li",[s("strong",[t._v("运行程序:")]),t._v(" 双击 羊先生抓包.exe (或您命名的程序名) 即可启动。")])])]),s("div",{staticClass:"tutorial-section"},[s("h3",[t._v("2. 首次启动与登录")]),s("ul",[s("li",[t._v("程序启动后，会首先显示一个登录窗口。")]),s("li",[t._v("您需要输入正确的用户名和密码进行登录。")]),s("li",[t._v("登录成功后，主界面才会加载并显示。如果关闭登录窗口，程序将退出。")])])]),s("div",{staticClass:"tutorial-section"},[s("h3",[t._v("3. 主界面概览")]),s("p",[t._v("主界面分为几个关键区域：")]),s("ul",[s("li",[s("strong",[t._v("菜单栏:")]),t._v(" 位于最顶部，提供文件、代理、工具、帮助等主要功能的入口。")]),s("li",[s("strong",[t._v("状态栏/工具栏:")]),t._v(" 菜单栏下方，显示服务状态、当前代理模式和上游代理等核心信息。")]),s("li",[s("strong",[t._v("请求列表 (左侧):")]),s("ul",[s("li",[t._v("显示所有捕获到的网络请求。")]),s("li",[t._v("包含序号、时间、状态码、方法、Host、路径等列。")]),s("li",[t._v("顶部有过滤器和搜索框，可以快速筛选请求。")]),s("li",[t._v('底部有"清除全部"、"导出选中"和"刷新"按钮。')])])]),s("li",[s("strong",[t._v("详情视图 (右侧):")]),s("ul",[s("li",[t._v("当在左侧列表中选中一个请求时，这里会显示该请求的详细信息。")]),s("li",[t._v("此区域由多个选项卡组成，方便查看不同维度的信息。")])])])])]),s("div",{staticClass:"tutorial-section"},[s("h3",[t._v("4. 捕获网络流量")]),s("ul",[s("li",[s("strong",[t._v("启动服务:")]),s("ul",[s("li",[t._v('通过菜单栏的"代理" -> "启动服务"来启动代理。')]),s("li",[t._v('启动后，服务状态会变为"运行中"。')])])]),s("li",[s("strong",[t._v("设置系统/应用代理:")]),s("ul",[s("li",[s("strong",[t._v("全局代理:")]),t._v(' 在"代理"菜单中选择"全局代理"。所有使用系统代理的应用程序（如浏览器）流量都将被捕获。')]),s("li",[s("strong",[t._v("指定进程代理:")]),s("ul",[s("li",[t._v("这是一个高级功能，可以只抓取某个特定软件的流量。首次使用需要安装驱动。")]),s("li",[t._v('通过"工具" -> "进程代理驱动设置"打开设置对话框。')]),s("li",[t._v('选择驱动类型（推荐默认）并点击"加载驱动"。注意：卸载驱动会强制重启电脑！')]),s("li",[t._v('加载成功后，在"代理"菜单中选择"指定进程代理"，然后选择要抓取流量的应用程序进程。')])])])])]),s("li",[s("strong",[t._v("停止服务:")]),t._v(' 完成抓包后，通过"代理" -> "停止服务"来关闭代理。')])])]),s("div",{staticClass:"tutorial-section"},[s("h3",[t._v("5. 分析请求")]),s("p",[t._v("选中左侧的任一请求，右侧的详情视图会更新：")]),s("ul",[s("li",[s("strong",[t._v('"请求/响应" 主选项卡:')]),s("ul",[s("li",[s("strong",[t._v("概览:")]),t._v(" 简要展示请求的关键信息。")]),s("li",[s("strong",[t._v("Headers:")]),t._v(" 分别显示请求和响应的头信息。")]),s("li",[s("strong",[t._v("Cookies:")]),t._v(" 显示与此请求相关的Cookie。")]),s("li",[s("strong",[t._v("JSON:")]),t._v(' 如果内容是JSON格式，这里会自动格式化显示。您可以点击"美化"或"原始"按钮切换视图。')]),s("li",[s("strong",[t._v("图片:")]),t._v(" 如果内容是图片，这里会直接显示图片，并提供缩放、保存等工具。")]),s("li",[s("strong",[t._v("原始数据:")]),t._v(" 显示未经处理的、最原始的请求和响应报文。")])])])])]),s("div",{staticClass:"tutorial-section"},[s("h3",[t._v("6. 核心功能：规则编辑")]),s("p",[t._v('这是本工具最强大的功能。通过"规则编辑"主选项卡进入管理界面。')]),s("p",[s("strong",[t._v("工作流程:")]),t._v(" 创建规则 -> 为规则添加动作 -> 启用规则。")]),s("ul",[s("li",[s("strong",[t._v("创建规则:")]),s("ul",[s("li",[t._v('点击"添加规则"按钮。')]),s("li",[s("strong",[t._v("URL模式:")]),t._v(" 输入您想匹配的网址。支持 * 和 ? 的通配符，或更复杂的正则表达式。")]),s("li",[s("strong",[t._v("执行时机:")]),t._v(" 选择请求时执行或响应后执行。")]),s("li",[t._v('勾选"启用规则"。')])])]),s("li",[s("strong",[t._v("添加动作:")]),t._v(" 一个规则可以包含多个按顺序执行的动作。 "),s("ul",[s("li",[s("strong",[t._v("拦截请求:")]),t._v(" 直接阻止请求发送。")]),s("li",[s("strong",[t._v("重定向请求:")]),t._v(" 将请求转发到另一个网址。")]),s("li",[s("strong",[t._v("解析响应内容 (最常用):")]),t._v(" 从响应内容中提取需要的数据（例如提取订单号、支付链接等）。")]),s("li",[s("strong",[t._v("解析二维码:")]),t._v(" 从网页中的二维码图片里提取内容。")]),s("li",[s("strong",[t._v("发送到订单:")]),t._v(" 一个定制化的动作，将处理好的数据（通常是支付链接）与当前选中的订单关联并发送。")])])])])]),s("div",{staticClass:"tutorial-section"},[s("h3",[t._v("7. 订单管理")]),s("p",[t._v('通过"用户配置和订单信息" -> "订单信息"主选项卡进入。')]),s("ul",[s("li",[s("strong",[t._v("订单列表:")]),t._v(" 以卡片形式展示所有订单。")]),s("li",[s("strong",[t._v("实时更新:")]),t._v(' 点击"启动WebSocket连接"按钮，可以实时从服务器接收新订单，无需手动刷新。')]),s("li",[s("strong",[t._v("工具栏:")]),t._v(" 提供全选、搜索、刷新、删除、导出等常用功能。")]),s("li",[s("strong",[t._v("扫描二维码:")]),t._v(' 点击"扫描二维码"可以打开一个窗口，实时识别屏幕上的二维码，极大地提升操作效率。')])])])]),s("div",{staticClass:"content-section"},[s("h2",[t._v("常见问题")]),s("div",{staticClass:"faq-list"},[s("div",{staticClass:"faq-item"},[s("div",{staticClass:"faq-question"},[t._v("无法抓取HTTPS流量 (网页显示不安全)")]),s("div",{staticClass:"faq-answer"},[t._v('请确保已通过菜单栏的"证书" -> "安装根证书"选项正确安装了本工具的根证书，并信任它。')])]),s("div",{staticClass:"faq-item"},[s("div",{staticClass:"faq-question"},[t._v("指定进程代理无效")]),s("div",{staticClass:"faq-answer"},[s("ul",[s("li",[t._v("请确保以管理员权限运行本程序。")]),s("li",[t._v("驱动加载/卸载需要管理员权限。")])])])]),s("div",{staticClass:"faq-item"},[s("div",{staticClass:"faq-question"},[t._v("二维码识别失败")]),s("div",{staticClass:"faq-answer"},[t._v("如果此功能无法使用，可能是程序缺少必要的运行库。")])])])]),s("div",{staticClass:"content-footer"},[s("a",{staticClass:"download-btn footer-download",attrs:{href:"https://xis.lanzouw.com/ixPSV2yrkoyh",target:"_blank"}},[s("i",{staticClass:"fas fa-download"}),s("span",[t._v("下载工具")])])])])])}],r={name:"ToolDownload",metaInfo:{title:"半自动抓包工具下载 - 羊先生抓包"}},n=r,o=(e("fee6"),e("2877")),l=Object(o["a"])(n,a,i,!1,null,"6b2c63c6",null);s["a"]=l.exports},"3f00":function(t,s,e){"use strict";e("a573");var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"order-query-page"},[s("div",{staticClass:"page-header"},[t._m(0),s("div",{staticClass:"page-actions"},[s("button",{staticClass:"action-btn export-btn",attrs:{title:"导出数据"},on:{click:t.exportData}},[s("i",{staticClass:"fas fa-file-export"}),s("span",[t._v("导出")])]),s("button",{staticClass:"action-btn refresh-btn",attrs:{title:"刷新数据"},on:{click:t.refreshOrders}},[s("i",{staticClass:"fas fa-sync-alt",class:{"fa-spin":t.loading}}),s("span",[t._v("刷新")])])])]),s("div",{staticClass:"filter-wrapper"},[s("div",{staticClass:"filter-header",class:{"mobile-clickable":t.isMobile},on:{click:function(s){t.isMobile&&t.toggleFilters()}}},[s("h3",{staticClass:"filter-title"},[s("i",{staticClass:"fas fa-filter"}),t._v(" 筛选条件 "),t.isMobile&&t.hasActiveFilters?s("span",{staticClass:"active-filters-count"},[t._v("("+t._s(t.activeFiltersCount)+")")]):t._e()]),s("div",{staticClass:"filter-header-actions"},[s("button",{staticClass:"filter-reset-btn",attrs:{title:"重置筛选"},on:{click:function(s){return s.stopPropagation(),t.resetFilters.apply(null,arguments)}}},[s("i",{staticClass:"fas fa-undo"}),s("span",{staticClass:"reset-text"},[t._v("重置")])]),t.isMobile?s("button",{staticClass:"filter-toggle-btn",attrs:{title:t.showFilters?"收起筛选":"展开筛选"},on:{click:function(s){return s.stopPropagation(),t.toggleFilters.apply(null,arguments)}}},[s("i",{class:["fas",t.showFilters?"fa-chevron-up":"fa-chevron-down"]})]):t._e()])]),s("div",{staticClass:"filter-content",class:{"mobile-collapsed":t.isMobile&&!t.showFilters}},[s("div",{staticClass:"filter-grid"},[s("div",{staticClass:"filter-item"},[t._m(1),s("div",{staticClass:"date-range-inputs"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.startDate,expression:"filters.startDate"}],staticClass:"form-input",attrs:{type:"date"},domProps:{value:t.filters.startDate},on:{input:function(s){s.target.composing||t.$set(t.filters,"startDate",s.target.value)}}}),s("span",{staticClass:"range-separator"},[t._v("至")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.endDate,expression:"filters.endDate"}],staticClass:"form-input",attrs:{type:"date"},domProps:{value:t.filters.endDate},on:{input:function(s){s.target.composing||t.$set(t.filters,"endDate",s.target.value)}}})])]),s("div",{staticClass:"filter-item"},[t._m(2),s("div",{staticClass:"amount-range-inputs"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.minAmount,expression:"filters.minAmount"}],staticClass:"form-input",attrs:{type:"number",placeholder:"最小金额"},domProps:{value:t.filters.minAmount},on:{input:function(s){s.target.composing||t.$set(t.filters,"minAmount",s.target.value)}}}),s("span",{staticClass:"range-separator"},[t._v("至")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.maxAmount,expression:"filters.maxAmount"}],staticClass:"form-input",attrs:{type:"number",placeholder:"最大金额"},domProps:{value:t.filters.maxAmount},on:{input:function(s){s.target.composing||t.$set(t.filters,"maxAmount",s.target.value)}}})])]),s("div",{staticClass:"filter-item"},[t._m(3),s("select",{directives:[{name:"model",rawName:"v-model",value:t.filters.channelId,expression:"filters.channelId"}],staticClass:"form-select",on:{change:function(s){var e=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var s="_value"in t?t._value:t.value;return s}));t.$set(t.filters,"channelId",s.target.multiple?e:e[0])}}},[s("option",{attrs:{value:""}},[t._v("全部通道")]),t._l(t.channels,(function(e){return s("option",{key:e.id,domProps:{value:e.id}},[t._v(" "+t._s(e.name)+" ")])}))],2)]),s("div",{staticClass:"filter-item"},[t._m(4),s("select",{directives:[{name:"model",rawName:"v-model",value:t.filters.status,expression:"filters.status"}],staticClass:"form-select",on:{change:function(s){var e=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var s="_value"in t?t._value:t.value;return s}));t.$set(t.filters,"status",s.target.multiple?e:e[0])}}},[s("option",{attrs:{value:""}},[t._v("全部状态")]),s("option",{attrs:{value:"pending"}},[t._v("待支付")]),s("option",{attrs:{value:"completed"}},[t._v("已完成")]),s("option",{attrs:{value:"failed"}},[t._v("已失败")])])]),s("div",{staticClass:"filter-item"},[t._m(5),s("select",{directives:[{name:"model",rawName:"v-model",value:t.filters.ipStatus,expression:"filters.ipStatus"}],staticClass:"form-select",on:{change:function(s){var e=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var s="_value"in t?t._value:t.value;return s}));t.$set(t.filters,"ipStatus",s.target.multiple?e:e[0])}}},[s("option",{attrs:{value:""}},[t._v("全部IP状态")]),s("option",{attrs:{value:"normal"}},[t._v("正常")]),s("option",{attrs:{value:"blocked"}},[t._v("已拉黑")])])]),s("div",{staticClass:"filter-item search-item"},[t._m(6),s("div",{staticClass:"search-input-wrapper"},[s("i",{staticClass:"fas fa-search search-icon"}),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.searchQuery,expression:"searchQuery",modifiers:{trim:!0}}],staticClass:"form-input search-input",attrs:{placeholder:"输入订单号或IP地址搜索..."},domProps:{value:t.searchQuery},on:{input:[function(s){s.target.composing||(t.searchQuery=s.target.value.trim())},t.debounceSearch],blur:function(s){return t.$forceUpdate()}}}),s("button",{directives:[{name:"show",rawName:"v-show",value:t.searchQuery,expression:"searchQuery"}],staticClass:"clear-search-btn",attrs:{type:"button",title:"清除搜索"},on:{click:t.clearSearch}},[s("i",{staticClass:"fas fa-times"})])])])])])]),s("div",{staticClass:"orders-list-container"},[t.loading?s("div",{staticClass:"loading-state"},[s("div",{staticClass:"spinner"}),s("span",[t._v("加载中...")])]):t.orders.length>0?s("div",{staticClass:"table-section"},[s("div",{staticClass:"table-header"},[s("div",{staticClass:"header-left"},[s("h2",[t._v("订单列表")]),s("div",{staticClass:"header-actions"},[s("div",{staticClass:"view-toggle"},[s("button",{staticClass:"view-toggle-btn",class:{active:"table"===t.viewMode},attrs:{title:"表格视图"},on:{click:t.toggleViewMode}},[s("i",{staticClass:"fas fa-table"})]),s("button",{staticClass:"view-toggle-btn",class:{active:"card"===t.viewMode},attrs:{title:"卡片视图"},on:{click:t.toggleViewMode}},[s("i",{staticClass:"fas fa-th"})])]),"table"===t.viewMode?s("div",{staticClass:"column-settings-container"},[s("button",{staticClass:"column-settings-btn",attrs:{title:"列设置"},on:{click:function(s){t.showColumnSettings=!t.showColumnSettings}}},[s("i",{staticClass:"fas fa-sliders-h"})]),t.showColumnSettings?s("div",{staticClass:"column-settings-popover",on:{click:function(t){t.stopPropagation()}}},[s("div",{staticClass:"popover-header"},[s("h4",[t._v("列显示设置")]),s("button",{staticClass:"popover-close-btn",on:{click:function(s){t.showColumnSettings=!1}}},[t._v("×")])]),s("div",{staticClass:"popover-body"},t._l(t.allTableHeaders,(function(e){return s("div",{key:e.key,staticClass:"column-item"},[s("label",{class:{disabled:e.required}},[s("span",{staticClass:"column-name"},[s("i",{class:t.getHeaderIcon(e.label)}),t._v(" "+t._s(e.label)+" ")]),s("div",{staticClass:"switch-container"},[s("input",{attrs:{type:"checkbox",disabled:e.required},domProps:{checked:e.visible},on:{change:function(s){return t.toggleColumn(e)}}}),s("span",{staticClass:"switch-slider"})])])])})),0),s("div",{staticClass:"popover-footer"},[s("button",{staticClass:"footer-btn",on:{click:t.showAllColumns}},[t._v("全部显示")]),s("button",{staticClass:"footer-btn reset",on:{click:t.resetColumns}},[t._v("恢复默认")])])]):t._e()]):t._e()])]),s("div",{staticClass:"header-right"},[s("div",{staticClass:"header-controls"},["card"===t.viewMode&&t.isMobile?s("div",{staticClass:"card-settings"},[s("button",{staticClass:"settings-btn",attrs:{title:"卡片设置"},on:{click:function(s){t.showCardSettings=!t.showCardSettings}}},[s("i",{staticClass:"fas fa-cog"})])]):t._e(),s("div",{staticClass:"search-container"},[s("i",{staticClass:"fas fa-search search-icon"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.quickSearchQuery,expression:"quickSearchQuery"}],staticClass:"search-input",attrs:{type:"text",placeholder:"快速搜索订单...","aria-label":"搜索订单"},domProps:{value:t.quickSearchQuery},on:{input:function(s){s.target.composing||(t.quickSearchQuery=s.target.value)}}}),t.quickSearchQuery?s("button",{staticClass:"clear-search-btn",attrs:{title:"清除搜索"},on:{click:function(s){t.quickSearchQuery=""}}},[s("i",{staticClass:"fas fa-times"})]):t._e()])])])]),"table"===t.viewMode?s("div",{staticClass:"table-wrapper"},[s("div",{staticClass:"table-container"},[s("table",{staticClass:"orders-table",attrs:{id:"orderTable",role:"table","aria-label":"订单列表"}},[s("thead",[s("tr",t._l(t.tableHeaders,(function(e){return s("th",{key:e,class:{"action-header":"操作"===e,"status-header":"状态"===e}},[s("div",{staticClass:"th-content"},[s("i",{staticClass:"header-icon",class:t.getHeaderIcon(e)}),s("span",{staticClass:"header-text"},[t._v(t._s(e))])])])})),0)]),s("tbody",t._l(t.filteredOrders,(function(e){var a,i,r;return s("tr",{key:e.orderId,class:{"enabled-row":e.isOnline,"disabled-row":!e.isOnline}},[t.isColumnVisible("orderId")?s("td",{staticClass:"id-cell"},[t._v(t._s(e.orderId))]):t._e(),t.isColumnVisible("amount")?s("td",{staticClass:"numeric-cell amount-cell"},[s("div",{staticClass:"amount-wrapper"},[s("i",{staticClass:"fas fa-money-bill-wave amount-icon"}),s("span",[t._v("¥"+t._s(t.formatAmount(e.amount)))])])]):t._e(),t.isColumnVisible("status")?s("td",{staticClass:"status-cell"},[s("span",{staticClass:"order-status",class:{"status-enabled":"completed"===e.status,"status-disabled":"failed"===e.status,"status-pending":"pending"===e.status},attrs:{role:"button",tabindex:"0"}},[s("span",{staticClass:"status-dot"}),t._v(" "+t._s(t.getStatusText(e.status))+" ")])]):t._e(),t.isColumnVisible("isOnline")?s("td",{staticClass:"responsive-hide-1"},[s("div",{staticClass:"users-wrapper"},[s("i",{staticClass:"fas fa-signal users-icon"}),s("span",[t._v(t._s(e.isOnline?"在线":"离线"))])])]):t._e(),t.isColumnVisible("createdAt")?s("td",{staticClass:"responsive-hide-2"},[s("div",{staticClass:"date-wrapper"},[s("i",{staticClass:"fas fa-calendar-alt date-icon"}),s("span",[t._v(t._s(t.formatDate(e.createdAt)))])])]):t._e(),t.isColumnVisible("channel")?s("td",[s("div",{staticClass:"channel-name"},[t._v(t._s((null===(a=e.channelId)||void 0===a?void 0:a.name)||"未知通道"))])]):t._e(),t.isColumnVisible("clientType")?s("td",{staticClass:"responsive-hide-3"},[s("div",{staticClass:"channel-type-cell"},[s("i",{staticClass:"payment-icon",class:[t.getClientTypeIcon(e.clientType),t.getClientTypeColor(e.clientType)]}),s("span",{staticClass:"type-text"},[t._v(t._s(t.getClientTypeText(e.clientType)))])])]):t._e(),t.isColumnVisible("ipAddress")?s("td",{staticClass:"identifier-cell"},[s("div",{staticClass:"identifier-wrapper"},[s("i",{staticClass:"fas fa-network-wired identifier-icon"}),s("span",[t._v(t._s(e.ipAddress))])])]):t._e(),t.isColumnVisible("ipLocation")?s("td",{staticClass:"responsive-hide-2"},[t._v(t._s(e.ipLocationStr||"未知"))]):t._e(),t.isColumnVisible("ipStatus")?s("td",{staticClass:"responsive-hide-1"},[s("span",{staticClass:"ip-status",class:{blocked:e.ipBlocked}},[t._v(" "+t._s(e.ipBlocked?"已拉黑":"正常")+" ")])]):t._e(),t.isColumnVisible("customerName")?s("td",{staticClass:"responsive-hide-3"},[t._v(t._s(e.customerName||"未知"))]):t._e(),t.isColumnVisible("user")&&t.isSuperAdmin?s("td",[t._v(t._s((null===(i=e.userId)||void 0===i?void 0:i.username)||"-"))]):t._e(),t.isColumnVisible("actions")?s("td",{staticClass:"actions-cell"},[s("div",{staticClass:"actions-wrapper"},["f2f"===(null===(r=e.channelId)||void 0===r?void 0:r.identifier)&&"pending"===e.status?s("button",{staticClass:"btn-action btn-qr",attrs:{title:"扫码支付"},on:{click:function(s){return t.openScanner(e)}}},[s("i",{staticClass:"fas fa-qrcode"}),s("span",{staticClass:"btn-text"},[t._v("扫码支付")])]):t._e(),s("button",{staticClass:"btn-action btn-settings",class:{"btn-block":!e.ipBlocked,"btn-unblock":e.ipBlocked},attrs:{title:e.ipBlocked?"解除拉黑":"拉黑IP"},on:{click:function(s){e.ipBlocked?t.unblockIP(e):t.blockIP(e)}}},[s("i",{class:["fas",e.ipBlocked?"fa-unlock":"fa-ban"]}),s("span",{staticClass:"btn-text"},[t._v(t._s(e.ipBlocked?"解除拉黑":"拉黑IP"))])]),s("button",{staticClass:"btn-action btn-chat",attrs:{title:"联系客户"},on:{click:function(s){return t.openChat(e)}}},[s("i",{staticClass:"fas fa-comments"}),s("span",{staticClass:"btn-text"},[t._v("联系客户")])])])]):t._e()])})),0)])]),0===t.filteredOrders.length?s("div",{staticClass:"no-data-state"},[t._m(7),s("p",{staticClass:"no-data-text"},[t._v("没有找到匹配的订单")]),t.quickSearchQuery?s("button",{staticClass:"clear-search",on:{click:function(s){t.quickSearchQuery=""}}},[t._v(" 清除搜索 ")]):t._e()]):t._e()]):"card"===t.viewMode?s("div",{staticClass:"order-cards"},t._l(t.filteredOrders,(function(e){var a,i;return s("div",{key:e.orderId,staticClass:"order-card",class:{enabled:e.isOnline,disabled:!e.isOnline,collapsed:t.isMobile&&!e.expanded}},[s("div",{staticClass:"card-header",class:{clickable:t.isMobile},on:{click:function(s){t.isMobile&&t.toggleCardExpansion(e)}}},[s("div",{staticClass:"card-title-area"},[s("h3",{staticClass:"card-title"},[t._v(t._s(e.orderId))]),s("div",{staticClass:"order-type-icons"},[s("span",{class:["client-type-badge",t.getClientTypeClass(e.clientType)]},[t._v(" "+t._s(t.getClientTypeText(e.clientType))+" ")])])]),s("div",{staticClass:"card-header-right"},[s("span",{staticClass:"order-status",class:{"status-enabled":"completed"===e.status,"status-disabled":"failed"===e.status,"status-pending":"pending"===e.status}},[s("span",{staticClass:"status-dot"}),t._v(" "+t._s(t.getStatusText(e.status))+" ")]),t.isMobile?s("div",{staticClass:"card-amount"},[s("span",{staticClass:"amount-value"},[t._v("¥"+t._s(t.formatAmount(e.amount)))])]):t._e(),t.isMobile?s("button",{staticClass:"expand-btn",on:{click:function(s){return s.stopPropagation(),t.toggleCardExpansion(e)}}},[s("i",{class:["fas",e.expanded?"fa-chevron-up":"fa-chevron-down"]})]):t._e()])]),s("div",{staticClass:"card-body",class:{collapsed:t.isMobile&&!e.expanded}},[s("div",{staticClass:"info-grid"},[t.isMobile?t._e():s("div",{staticClass:"info-item"},[t._m(8,!0),s("div",{staticClass:"info-content"},[s("span",{staticClass:"info-label"},[t._v("订单金额")]),s("span",{staticClass:"info-value"},[t._v("¥"+t._s(t.formatAmount(e.amount)))])])]),s("div",{staticClass:"info-item"},[t._m(9,!0),s("div",{staticClass:"info-content"},[s("span",{staticClass:"info-label"},[t._v("创建时间")]),s("span",{staticClass:"info-value"},[t._v(t._s(t.formatDate(e.createdAt)))])])]),s("div",{staticClass:"info-item"},[t._m(10,!0),s("div",{staticClass:"info-content"},[s("span",{staticClass:"info-label"},[t._v("在线状态")]),s("span",{staticClass:"info-value"},[t._v(t._s(e.isOnline?"在线":"离线"))])])]),s("div",{staticClass:"info-item"},[t._m(11,!0),s("div",{staticClass:"info-content"},[s("span",{staticClass:"info-label"},[t._v("支付通道")]),s("span",{staticClass:"info-value"},[t._v(t._s((null===(a=e.channelId)||void 0===a?void 0:a.name)||"未知通道"))])])]),s("div",{staticClass:"info-item"},[t._m(12,!0),s("div",{staticClass:"info-content"},[s("span",{staticClass:"info-label"},[t._v("IP地址")]),s("span",{staticClass:"info-value"},[t._v(t._s(e.ipAddress))])])]),s("div",{staticClass:"info-item"},[t._m(13,!0),s("div",{staticClass:"info-content"},[s("span",{staticClass:"info-label"},[t._v("IP归属地")]),s("span",{staticClass:"info-value"},[t._v(t._s(e.ipLocationStr||"未知"))])])]),s("div",{staticClass:"info-item"},[t._m(14,!0),s("div",{staticClass:"info-content"},[s("span",{staticClass:"info-label"},[t._v("IP状态")]),s("span",{staticClass:"info-value"},[s("span",{staticClass:"ip-status",class:{blocked:e.ipBlocked}},[t._v(" "+t._s(e.ipBlocked?"已拉黑":"正常")+" ")])])])]),e.customerName?s("div",{staticClass:"info-item"},[t._m(15,!0),s("div",{staticClass:"info-content"},[s("span",{staticClass:"info-label"},[t._v("客户姓名")]),s("span",{staticClass:"info-value"},[t._v(t._s(e.customerName))])])]):t._e()])]),s("div",{staticClass:"card-actions",class:{collapsed:t.isMobile&&!e.expanded}},["f2f"===(null===(i=e.channelId)||void 0===i?void 0:i.identifier)&&"pending"===e.status?s("button",{staticClass:"btn-qr",on:{click:function(s){return t.openScanner(e)}}},[s("i",{staticClass:"fas fa-qrcode"}),s("span",[t._v("扫码支付")])]):t._e(),s("button",{staticClass:"btn-settings",class:{"btn-block":!e.ipBlocked,"btn-unblock":e.ipBlocked},on:{click:function(s){e.ipBlocked?t.unblockIP(e):t.blockIP(e)}}},[s("i",{class:["fas",e.ipBlocked?"fa-unlock":"fa-ban"]}),s("span",[t._v(t._s(e.ipBlocked?"解除拉黑":"拉黑IP"))])]),s("button",{staticClass:"btn-chat",on:{click:function(s){return t.openChat(e)}}},[s("i",{staticClass:"fas fa-comments"}),s("span",[t._v("联系客户")])])])])})),0):t.isMobile?s("div",{staticClass:"mobile-cards"},t._l(t.orders,(function(e){var a,i;return s("div",{key:e.orderId,staticClass:"order-card",class:{expanded:e.showDetails}},[s("div",{staticClass:"card-header",on:{click:function(s){return t.toggleOrderDetails(e)}}},[s("div",{staticClass:"card-header-left"},[s("div",{staticClass:"order-id-section"},[s("span",{staticClass:"order-id-label"},[t._v("订单号")]),s("span",{staticClass:"order-id-value"},[t._v(t._s(e.orderId))])]),s("div",{staticClass:"status-group"},[s("span",{class:["status-badge",t.getStatusClass(e.status)]},[t._v(" "+t._s(t.getStatusText(e.status))+" ")]),s("div",{class:["online-status",{"is-online":e.isOnline}]},[s("span",{staticClass:"online-dot"}),t._v(" "+t._s(e.isOnline?"在线":"离线")+" ")])])]),s("div",{staticClass:"card-header-right"},[s("div",{staticClass:"amount-display"},[s("span",{staticClass:"amount-label"},[t._v("金额")]),s("span",{staticClass:"amount-value"},[t._v("¥"+t._s(t.formatAmount(e.amount)))])]),s("i",{staticClass:"toggle-icon fas",class:e.showDetails?"fa-chevron-up":"fa-chevron-down"})])]),s("div",{staticClass:"card-details-wrapper",class:{show:e.showDetails}},[s("div",{staticClass:"card-details"},[s("div",{staticClass:"info-row"},[s("span",{staticClass:"label"},[t._v("创建时间")]),s("span",{staticClass:"value"},[t._v(t._s(t.formatDate(e.createdAt)))])]),s("div",{staticClass:"info-row"},[s("span",{staticClass:"label"},[t._v("通道")]),s("span",{staticClass:"value"},[t._v(t._s((null===(a=e.channelId)||void 0===a?void 0:a.name)||"未知通道"))])]),s("div",{staticClass:"info-row"},[s("span",{staticClass:"label"},[t._v("支付方式")]),s("span",{staticClass:"value"},[s("span",{class:["client-type-badge",t.getClientTypeClass(e.clientType)]},[t._v(" "+t._s(t.getClientTypeText(e.clientType))+" ")])])]),s("div",{staticClass:"info-row"},[s("span",{staticClass:"label"},[t._v("IP地址")]),s("span",{staticClass:"value"},[t._v(t._s(e.ipAddress))])]),s("div",{staticClass:"info-row"},[s("span",{staticClass:"label"},[t._v("IP归属地")]),s("span",{staticClass:"value"},[t._v(t._s(e.ipLocationStr||"未知"))])]),s("div",{staticClass:"info-row"},[s("span",{staticClass:"label"},[t._v("IP状态")]),s("span",{staticClass:"value"},[s("span",{staticClass:"ip-status",class:{blocked:e.ipBlocked}},[t._v(" "+t._s(e.ipBlocked?"已拉黑":"正常")+" ")])])]),e.customerName?s("div",{staticClass:"info-row"},[s("span",{staticClass:"label"},[t._v("姓名")]),s("span",{staticClass:"value"},[t._v(t._s(e.customerName))])]):t._e(),s("div",{staticClass:"card-actions"},["f2f"===(null===(i=e.channelId)||void 0===i?void 0:i.identifier)&&"pending"===e.status?s("button",{staticClass:"action-btn scan-btn",on:{click:function(s){return s.stopPropagation(),t.openScanner(e)}}},[s("i",{staticClass:"fas fa-qrcode"}),t._v(" 扫码支付 ")]):t._e(),s("button",{staticClass:"action-btn",class:{"block-btn":!e.ipBlocked,"unblock-btn":e.ipBlocked},on:{click:function(s){s.stopPropagation(),e.ipBlocked?t.unblockIP(e):t.blockIP(e)}}},[s("i",{class:["fas",e.ipBlocked?"fa-unlock":"fa-ban"]}),t._v(" "+t._s(e.ipBlocked?"解除拉黑":"拉黑IP")+" ")]),s("button",{staticClass:"action-btn chat-btn",on:{click:function(s){return s.stopPropagation(),t.openChat(e)}}},[s("i",{staticClass:"fas fa-comments"}),t._v(" 联系客户 ")])])])])])})),0):t._e(),t.pagination.total>0?s("div",{staticClass:"pagination"},[s("button",{staticClass:"page-btn",attrs:{disabled:1===t.currentPage},on:{click:function(s){return t.loadOrders(t.currentPage-1)}}},[s("i",{staticClass:"fas fa-chevron-left"})]),s("div",{staticClass:"page-numbers"},t._l(t.displayedPages,(function(e){return s("button",{key:e,class:["page-btn",{active:e===t.currentPage}],on:{click:function(s){return t.loadOrders(e)}}},[t._v(" "+t._s(e)+" ")])})),0),s("button",{staticClass:"page-btn",attrs:{disabled:t.currentPage===t.pagination.pages},on:{click:function(s){return t.loadOrders(t.currentPage+1)}}},[s("i",{staticClass:"fas fa-chevron-right"})]),s("span",{staticClass:"page-info"},[t._v(" 共 "+t._s(t.pagination.total)+" 条记录 ")])]):t._e()]):s("div",{staticClass:"empty-state"},[s("i",{staticClass:"fas fa-inbox"}),s("p",[t._v("暂无订单数据")])])]),t.showCardSettings?s("div",{staticClass:"settings-modal-overlay",on:{click:function(s){t.showCardSettings=!1}}},[s("div",{staticClass:"settings-modal-content",on:{click:function(t){t.stopPropagation()}}},[s("div",{staticClass:"settings-modal-header"},[t._m(16),s("button",{staticClass:"modal-close-btn",attrs:{title:"关闭"},on:{click:function(s){t.showCardSettings=!1}}},[s("i",{staticClass:"fas fa-times"})])]),s("div",{staticClass:"settings-modal-body"},[s("div",{staticClass:"setting-item"},[s("label",{staticClass:"setting-label"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.cardSettings.defaultCollapsed,expression:"cardSettings.defaultCollapsed"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.cardSettings.defaultCollapsed)?t._i(t.cardSettings.defaultCollapsed,null)>-1:t.cardSettings.defaultCollapsed},on:{change:[function(s){var e=t.cardSettings.defaultCollapsed,a=s.target,i=!!a.checked;if(Array.isArray(e)){var r=null,n=t._i(e,r);a.checked?n<0&&t.$set(t.cardSettings,"defaultCollapsed",e.concat([r])):n>-1&&t.$set(t.cardSettings,"defaultCollapsed",e.slice(0,n).concat(e.slice(n+1)))}else t.$set(t.cardSettings,"defaultCollapsed",i)},t.saveCardSettings]}}),s("span",[t._v("默认折叠卡片")])])]),s("div",{staticClass:"setting-item"},[s("button",{staticClass:"setting-action-btn",on:{click:function(s){return t.toggleAllCards(!0)}}},[s("i",{staticClass:"fas fa-compress-alt"}),t._v(" 全部折叠 ")])]),s("div",{staticClass:"setting-item"},[s("button",{staticClass:"setting-action-btn",on:{click:function(s){return t.toggleAllCards(!1)}}},[s("i",{staticClass:"fas fa-expand-alt"}),t._v(" 全部展开 ")])])])])]):t._e(),t.showBlacklistModal?s("div",{staticClass:"modal-overlay",on:{click:t.closeBlacklistModal}},[s("div",{staticClass:"modal blacklist-modal",on:{click:function(t){t.stopPropagation()}}},[s("div",{staticClass:"modal-header"},[s("h3",[t._v("IP黑名单")]),s("button",{staticClass:"close-btn",on:{click:t.closeBlacklistModal}},[s("i",{staticClass:"fas fa-times"})])]),s("div",{staticClass:"modal-content"},[s("div",{staticClass:"blacklist-search"},[s("i",{staticClass:"fas fa-search"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.blacklistSearch,expression:"blacklistSearch"}],attrs:{placeholder:"搜索IP地址..."},domProps:{value:t.blacklistSearch},on:{input:function(s){s.target.composing||(t.blacklistSearch=s.target.value)}}})]),s("div",{staticClass:"blacklist-list"},[t._l(t.filteredBlacklist,(function(e){var a;return s("div",{key:e._id,staticClass:"blacklist-item"},[s("div",{staticClass:"ip-info"},[s("span",{staticClass:"ip"},[t._v(t._s(e.ipAddress))]),s("span",{staticClass:"time"},[t._v(t._s(t.formatDate(e.createdAt)))])]),s("div",{staticClass:"block-info"},[s("span",{staticClass:"reason"},[t._v(t._s(e.reason||"无原因"))]),s("span",{staticClass:"blocker"},[t._v("by "+t._s((null===(a=e.blockedBy)||void 0===a?void 0:a.username)||"未知"))])]),s("button",{staticClass:"unblock-btn",on:{click:function(s){return t.unblockIP({ipAddress:e.ipAddress})}}},[s("i",{staticClass:"fas fa-unlock"}),t._v(" 解除拉黑 ")])])})),0===t.blacklist.length?s("div",{staticClass:"empty-blacklist"},[s("i",{staticClass:"fas fa-check-circle"}),s("p",[t._v("暂无拉黑记录")])]):t._e()],2)])])]):t._e(),t.showChat&&t.selectedOrder&&t.selectedOrder.orderId?s("CustomerService",{attrs:{orderId:t.selectedOrder.orderId},on:{"chat-closed":t.handleChatClosed}}):t._e(),t.showScanner?s("div",{staticClass:"scanner-modal"},[s("div",{staticClass:"scanner-content"},[s("div",{staticClass:"scanner-header"},[s("h3",[t._v("扫码支付")]),s("button",{staticClass:"close-btn",on:{click:t.closeScanner}},[s("i",{staticClass:"fas fa-times"})])]),s("div",{staticClass:"scanner-body"},[s("div",{staticClass:"camera-container"},[s("video",{ref:"video",staticClass:"scanner-video",attrs:{playsinline:""}}),s("canvas",{ref:"canvas",staticStyle:{display:"none"}}),t._m(17)]),s("div",{staticClass:"scanner-tips"},[t._v(" 请将支付宝付款码对准扫描框 ")])])])]):t._e()],1)},i=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"header-content"},[s("h1",{staticClass:"page-title"},[s("i",{staticClass:"fas fa-search"}),t._v(" 订单查询 ")]),s("p",{staticClass:"page-subtitle"},[t._v("管理和查看所有订单信息")])])},function(){var t=this,s=t._self._c;return s("label",{staticClass:"filter-label"},[s("i",{staticClass:"far fa-calendar-alt"}),t._v(" 日期范围 ")])},function(){var t=this,s=t._self._c;return s("label",{staticClass:"filter-label"},[s("i",{staticClass:"fas fa-yen-sign"}),t._v(" 金额范围 ")])},function(){var t=this,s=t._self._c;return s("label",{staticClass:"filter-label"},[s("i",{staticClass:"fas fa-credit-card"}),t._v(" 支付通道 ")])},function(){var t=this,s=t._self._c;return s("label",{staticClass:"filter-label"},[s("i",{staticClass:"fas fa-info-circle"}),t._v(" 订单状态 ")])},function(){var t=this,s=t._self._c;return s("label",{staticClass:"filter-label"},[s("i",{staticClass:"fas fa-shield-alt"}),t._v(" IP状态 ")])},function(){var t=this,s=t._self._c;return s("label",{staticClass:"filter-label"},[s("i",{staticClass:"fas fa-search"}),t._v(" 快速搜索 ")])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"no-data-icon"},[s("i",{staticClass:"fas fa-search"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"info-icon"},[s("i",{staticClass:"fas fa-money-bill-wave"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"info-icon"},[s("i",{staticClass:"fas fa-calendar-alt"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"info-icon"},[s("i",{staticClass:"fas fa-signal"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"info-icon"},[s("i",{staticClass:"fas fa-credit-card"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"info-icon"},[s("i",{staticClass:"fas fa-network-wired"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"info-icon"},[s("i",{staticClass:"fas fa-map-marker-alt"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"info-icon"},[s("i",{staticClass:"fas fa-shield-alt"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"info-icon"},[s("i",{staticClass:"fas fa-user"})])},function(){var t=this,s=t._self._c;return s("h4",{staticClass:"settings-modal-title"},[s("i",{staticClass:"fas fa-cogs"}),t._v(" 卡片视图设置 ")])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"scan-overlay"},[s("div",{staticClass:"scan-area"})])}],r=(e("d9e2"),e("14d9"),e("13d5"),e("1e70"),e("79a4"),e("c1a1"),e("8b00"),e("a4e7"),e("1e5a"),e("72c3"),e("0643"),e("2382"),e("fffc"),e("4e3e"),e("9d4a"),e("9a9a"),e("88a7"),e("271a"),e("5494"),e("b670")),n=e("ecec"),o=e.n(n),l=e("5c96"),c={name:"OrderQuery",components:{CustomerService:r["a"]},data(){return{orders:[],loading:!1,summary:{totalAmount:0,successfulOrders:0,onlineCount:0,failedOrders:0},searchQuery:"",quickSearchQuery:"",searchTimeout:null,viewMode:localStorage.getItem("orderViewMode")||"table",tableHeaders:[],allTableHeaders:[{key:"orderId",label:"订单号",visible:!0,required:!0},{key:"amount",label:"金额",visible:!0},{key:"status",label:"状态",visible:!0},{key:"isOnline",label:"在线状态",visible:!0},{key:"createdAt",label:"创建时间",visible:!0},{key:"channel",label:"通道",visible:!0},{key:"clientType",label:"支付方式",visible:!1},{key:"ipAddress",label:"IP地址",visible:!0},{key:"ipLocation",label:"IP归属地",visible:!1},{key:"ipStatus",label:"IP状态",visible:!1},{key:"customerName",label:"姓名",visible:!1},{key:"user",label:"用户",visible:!1,superAdminOnly:!0},{key:"actions",label:"操作",visible:!0,required:!0}],showColumnSettings:!1,showFilters:!0,filters:{startDate:"",endDate:"",minAmount:"",maxAmount:"",status:"",channelId:"",sortBy:"createdAt",sortOrder:"desc",ipStatus:""},pagination:{total:0,page:1,limit:20,pages:0},channels:[],refreshTimer:null,isMobile:!1,showBlacklistModal:!1,blacklist:[],blacklistSearch:"",unreadMessages:new Set,chatModalVisible:!1,currentOrder:null,audio:null,notificationAudio:null,selectedOrder:null,showChat:!1,currentOrderId:null,onlineOrders:new Set,showScanner:!1,stream:null,scanningInterval:null,expandedOrders:new Set,showCardSettings:!1,cardSettings:{defaultCollapsed:JSON.parse(localStorage.getItem("cardDefaultCollapsed")||"true")}}},computed:{filteredOrders(){if(!this.quickSearchQuery)return this.orders;const t=this.quickSearchQuery.toLowerCase();return this.orders.filter(s=>{var e;const a={orderId:s.orderId,ipAddress:s.ipAddress,customerName:s.customerName,channelName:null===(e=s.channelId)||void 0===e?void 0:e.name,status:this.getStatusText(s.status)};return Object.values(a).some(s=>String(s||"").toLowerCase().includes(t))})},hasActiveFilters(){return!!(this.filters.startDate||this.filters.endDate||this.filters.minAmount||this.filters.maxAmount||this.filters.status||this.filters.channelId||this.filters.ipStatus||this.searchQuery)},activeFiltersCount(){let t=0;return(this.filters.startDate||this.filters.endDate)&&t++,(this.filters.minAmount||this.filters.maxAmount)&&t++,this.filters.status&&t++,this.filters.channelId&&t++,this.filters.ipStatus&&t++,this.searchQuery&&t++,t},visibleTableColumns(){return this.allTableHeaders.filter(t=>t.visible&&!(t.superAdminOnly&&!this.isSuperAdmin)).map(t=>({key:t.key,name:t.label,icon:t.icon,required:t.required}))},currentPage(){return this.pagination.page},displayedPages(){const t=this.pagination.pages,s=this.currentPage,e=2;let a=[];a.push(1);for(let i=s-e;i<=s+e;i++)i>1&&i<t&&a.push(i);return t>1&&a.push(t),a=[...new Set(a)].sort((t,s)=>t-s),a},sortOrderIcon(){return"asc"===this.filters.sortOrder?"fas fa-sort-amount-up":"fas fa-sort-amount-down"},isSuperAdmin(){return"superadmin"===localStorage.getItem("userRole")},filteredBlacklist(){if(!this.blacklistSearch)return this.blacklist;const t=this.blacklistSearch.toLowerCase();return this.blacklist.filter(s=>s.ipAddress.toLowerCase().includes(t)||s.reason&&s.reason.toLowerCase().includes(t))},canViewOnlineStatus(){return!0}},methods:{exportData(){const t=["订单号","金额","状态","创建时间","通道","支付方式","IP地址","IP归属地","IP状态","姓名"],s=this.orders.map(t=>{var s;return[t.orderId,t.amount,this.getStatusText(t.status),this.formatDate(t.createdAt),(null===(s=t.channelId)||void 0===s?void 0:s.name)||"未知通道",this.getClientTypeText(t.clientType),t.ipAddress,t.ipLocationStr||"未知",t.ipBlocked?"已拉黑":"正常",t.customerName||"未知"]});let e=t.join(",")+"\n";s.forEach(t=>{const s=t.map(t=>t&&(String(t).includes(",")||String(t).includes('"'))?`"${String(t).replace(/"/g,'""')}"`:t);e+=s.join(",")+"\n"});const a=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),r=document.createElement("a"),n=(new Date).toISOString().split("T")[0];r.setAttribute("href",i),r.setAttribute("download",`订单数据_${n}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),this.$message.success("订单数据导出成功")},debounceSearch(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.loadOrders(1)},500)},clearSearch(){this.searchQuery="",this.loadOrders(1)},async loadBlacklist(){try{const t=await this.$api.get("/api/orders/blacklist");this.blacklist=t.data}catch(t){console.error("Load blacklist error:",t),this.$message.error("加载黑名单数据失败")}},async loadOrders(t=1){try{this.loading=!0;const s={page:t,limit:this.pagination.limit,...this.filters,search:this.searchQuery.trim()},e=await this.$api.get("/api/orders",{params:s}),a=e.data.orders.map(t=>{const s=this.orders.find(s=>s.orderId===t.orderId);return{...t,isOnline:!!s&&s.isOnline}});this.orders=a,this.pagination=e.data.pagination,this.applyDefaultCollapsedState(),this.$nextTick(()=>{this.initializeSocket(),this.$socket&&this.orders.length>0&&this.$socket.emit("refresh-online-status",{orderIds:this.orders.map(t=>t.orderId)})})}catch(s){console.error("加载订单列表错误:",s),this.isMobile||this.$message.error("加载订单列表失败")}finally{this.loading=!1}},toggleSortOrder(){this.filters.sortOrder="asc"===this.filters.sortOrder?"desc":"asc",this.loadOrders(1)},async refreshOrders(){try{const t=[...this.orders];await this.loadOrders(this.pagination.page),this.initializeSocket(),this.$socket&&this.orders.length>0&&this.$socket.emit("refresh-online-status",{orderIds:this.orders.map(t=>t.orderId)});const s=JSON.stringify(t)!==JSON.stringify(this.orders);s&&!this.isMobile&&this.$message.success("订单列表已更新")}catch(t){console.error("刷新订单列表错误:",t),this.isMobile||this.$message.error("刷新订单列表失败")}},startAutoRefresh(){this.refreshTimer=setInterval(this.refreshOrders,6e4)},stopAutoRefresh(){this.refreshTimer&&clearInterval(this.refreshTimer)},async loadChannels(){try{const t=await this.$api.get("/api/channels");this.channels=t.data}catch(t){this.$message.error("加载通道列表失败")}},formatAmount(t){return t?parseFloat(t).toFixed(2):"未输入"},formatDate(t){return t?new Date(t).toLocaleString():"-"},formatDateOnly(t){return t?new Date(t).toLocaleDateString():"-"},formatTimeOnly(t){return t?new Date(t).toLocaleTimeString():"-"},formatTimeShort(t){if(!t)return"-";const s=new Date,e=new Date(t),a=s-e,i=Math.floor(a/6e4),r=Math.floor(a/36e5),n=Math.floor(a/864e5);return i<1?"刚刚":i<60?i+"分钟前":r<24?r+"小时前":n<7?n+"天前":e.toLocaleDateString()},resetFilters(){this.filters={startDate:"",endDate:"",minAmount:"",maxAmount:"",status:"",channelId:"",sortBy:"createdAt",sortOrder:"desc",ipStatus:""},this.searchQuery="",this.loadOrders(1)},toggleViewMode(){this.viewMode="table"===this.viewMode?"card":"table",localStorage.setItem("orderViewMode",this.viewMode)},getHeaderIcon(t){const s={"订单号":"fas fa-hashtag","金额":"fas fa-yen-sign","状态":"fas fa-info-circle","在线状态":"fas fa-signal","创建时间":"far fa-clock","通道":"fas fa-credit-card","支付方式":"fas fa-mobile-alt","IP地址":"fas fa-network-wired","IP归属地":"fas fa-map-marker-alt","IP状态":"fas fa-shield-alt","姓名":"fas fa-user","用户":"fas fa-users","操作":"fas fa-cogs"};return s[t]||"fas fa-question-circle"},getStatusClass(t){return{pending:"status-pending",completed:"status-completed",failed:"status-failed"}[t]||"status-pending"},getStatusText(t){return{pending:"待支付",completed:"已完成",failed:"已失败"}[t]||"未知"},getStatusIcon(t){return{pending:"fas fa-clock",completed:"fas fa-check-circle",failed:"fas fa-times-circle"}[t]||"fas fa-question-circle"},getClientTypeIcon(t){return{wechat:"fab fa-weixin",alipay:"fab fa-alipay",alipay_wechat:"fas fa-mobile-alt",other:"fas fa-credit-card"}[t]||"fas fa-question-circle"},getClientTypeColor(t){const s={wechat:"wechat-color",alipay:"alipay-color",other:"other-color"};return s[t]||""},toggleFilters(){this.showFilters=!this.showFilters},toggleCardExpansion(t){this.$set(t,"expanded",!t.expanded)},toggleAllCards(t){this.orders.forEach(s=>{this.$set(s,"expanded",!t)}),this.showCardSettings=!1},saveCardSettings(){localStorage.setItem("cardDefaultCollapsed",JSON.stringify(this.cardSettings.defaultCollapsed)),this.applyDefaultCollapsedState()},applyDefaultCollapsedState(){this.orders.forEach(t=>{void 0===t.expanded&&this.$set(t,"expanded",!this.cardSettings.defaultCollapsed)})},loadColumnSettings(){const t=localStorage.getItem("tableColumnSettings");if(t){const s=JSON.parse(t);this.allTableHeaders.forEach(t=>{void 0!==s[t.key]&&(t.visible=s[t.key])})}this.updateVisibleHeaders()},saveColumnSettings(){const t=this.allTableHeaders.reduce((t,s)=>(t[s.key]=s.visible,t),{});localStorage.setItem("tableColumnSettings",JSON.stringify(t))},toggleColumn(t){t.required||(t.visible=!t.visible,this.updateVisibleHeaders(),this.saveColumnSettings())},resetColumns(){this.allTableHeaders.forEach(t=>{const s=["orderId","amount","status","isOnline","createdAt","channel","ipAddress","actions"];t.visible=s.includes(t.key)}),this.updateVisibleHeaders(),this.saveColumnSettings(),this.showColumnSettings=!1},showAllColumns(){this.allTableHeaders.forEach(t=>{t.visible=!0}),this.updateVisibleHeaders(),this.saveColumnSettings(),this.showColumnSettings=!1},updateVisibleHeaders(){this.tableHeaders=this.allTableHeaders.filter(t=>t.visible&&!(t.superAdminOnly&&!this.isSuperAdmin)).map(t=>t.label)},isColumnVisible(t){const s=this.allTableHeaders.find(s=>s.key===t);return!!s&&s.visible},applyPreset(t){"essential"===t?this.visibleColumns=["orderId","amount","status","actions"]:"full"===t&&(this.visibleColumns=this.allTableHeaders.map(t=>t.key)),this.saveColumnSettings(),this.showColumnSettings=!1},getCellClass(t){const s={orderId:"id-cell",amount:"numeric-cell amount-cell",status:"status-cell",isOnline:"responsive-hide-1",createdAt:"responsive-hide-2",channel:"",clientType:"responsive-hide-3",ipAddress:"identifier-cell",ipLocation:"responsive-hide-2",ipStatus:"responsive-hide-1",customerName:"responsive-hide-3",userId:"",actions:"actions-cell"};return s[t]||""},async blockIP(t){try{await this.$api.post("/api/orders/block-ip",{orderId:t._id,reason:"手动拉黑"}),this.orders.forEach(s=>{s.ipAddress===t.ipAddress&&(s.ipBlocked=!0,s.blocked=!0)}),this.$message.success("IP已拉黑"),await this.loadBlacklist()}catch(a){var s,e;console.error("Block IP error:",a),this.$message.error((null===(s=a.response)||void 0===s||null===(e=s.data)||void 0===e?void 0:e.message)||"拉黑IP失败")}},async unblockIP(t){try{await this.$api.post("/api/orders/unblock-ip",{ipAddress:t.ipAddress}),this.orders.forEach(s=>{s.ipAddress===t.ipAddress&&(s.ipBlocked=!1,s.blocked=!1)}),this.$message.success("已解除拉黑"),await this.loadBlacklist()}catch(a){var s,e;console.error("Unblock IP error:",a),this.$message.error((null===(s=a.response)||void 0===s||null===(e=s.data)||void 0===e?void 0:e.message)||"解除拉黑失败")}},checkMobile(){this.isMobile=window.innerWidth<=768},async showBlacklist(){try{const t=await this.$api.get("/api/orders/blacklist");this.blacklist=t.data,this.showBlacklistModal=!0}catch(t){this.$message.error("获取黑名单失败")}},closeBlacklistModal(){this.showBlacklistModal=!1,this.blacklistSearch=""},initializeSocket(){if(!this.$socket)return;const t=localStorage.getItem("currentUserId"),s=localStorage.getItem("userRole");this.orders.forEach(e=>{const a=e.userId===t,i="superadmin"===s;this.$socket.emit("join-chat",{orderId:e.orderId,userId:t,userRole:s}),this.$socket.off("chat:"+e.orderId),this.$socket.off("user-online:"+e.orderId),(a||i)&&(this.$socket.on("chat:"+e.orderId,t=>{if("user"===t.sender){this.playNotificationSound(),this.showNotification(e.orderId,t.content),this.unreadMessages.add(e.orderId);const s=this.orders.findIndex(t=>t.orderId===e.orderId);-1!==s&&this.$set(this.orders[s],"hasUnreadMessage",!0)}}),this.$socket.on("user-online:"+e.orderId,t=>{const s=this.orders.findIndex(t=>t.orderId===e.orderId);-1!==s&&this.$set(this.orders[s],"isOnline","online"===t.status)}))}),this.$socket.off("newOrder"),this.$socket.on("newOrder",t=>{t&&t.orderId&&this.handleNewOrder(t)})},playNotificationSound(){this.notificationAudio&&(this.notificationAudio.currentTime=0,this.notificationAudio.play().catch(()=>{}))},showNotification(t,s){if("granted"===Notification.permission){const e=new Notification("新的客服消息",{body:`订单 ${t} 有新消息: ${s}`,icon:"/logo.png",tag:t,requireInteraction:!0});e.onclick=()=>{const s=this.orders.find(s=>s.orderId===t);s&&(this.openChat(s),window.focus()),e.close()}}},openChat(t){if("string"===typeof t){const s=this.orders.find(s=>s.orderId===t);if(!s)return;t=s}if(!t||!t.orderId)return;this.selectedOrder={...t,orderId:t.orderId},this.showChat=!0,this.unreadMessages.delete(t.orderId);const s=this.orders.findIndex(s=>s.orderId===t.orderId);-1!==s&&this.$set(this.orders[s],"hasUnreadMessage",!1),this.$root.$emit("chat-window-state",t.orderId,!0)},handleChatClosed(){this.selectedOrder&&this.selectedOrder.orderId&&this.$root.$emit("chat-window-state",this.selectedOrder.orderId,!1),this.showChat=!1,this.selectedOrder=null},handleContactClick(t){t&&t.orderId&&this.openChat(t)},handleOrderIdChange(t){if(!t)return;const s=this.orders.find(s=>s.orderId===t);s?this.openChat(s):this.loadOrders().then(()=>{const s=this.orders.find(s=>s.orderId===t);s&&this.openChat(s)})},getClientTypeClass(t){return{"client-wechat":"wechat"===t,"client-alipay":"alipay"===t,"client-other":"other"===t||!t}},getClientTypeText(t){const s={wechat:"微信",alipay:"支付宝",alipay_wechat:"支付宝/微信",other:"其他"};return s[t]||"未知"},async handleNewOrder(t){try{const e=localStorage.getItem("currentUserId"),a=localStorage.getItem("userRole"),i=t.userId===e,r="superadmin"===a;if(!i&&!r)return;if(1!==this.pagination.page)return void await this.loadOrders(this.pagination.page);const n={page:1,limit:this.pagination.limit,...this.filters,search:this.searchQuery.trim()};let o;try{o=await this.$api.get("/api/orders",{params:n})}catch(s){console.warn("获取订单列表时出现非致命错误:",s);const e=this.orders.find(s=>s.orderId===t.orderId);return void(e||this.orders.unshift({...t,isOnline:!0}))}const l=o.data.orders.map(s=>{var e;return{...s,isOnline:s.orderId===t.orderId||((null===(e=this.orders.find(t=>t.orderId===s.orderId))||void 0===e?void 0:e.isOnline)||!1)}});if(this.orders=l,this.pagination=o.data.pagination,this.$nextTick(()=>{this.initializeSocket(),this.$socket&&this.orders.length>0&&this.$socket.emit("refresh-online-status",{orderIds:this.orders.map(t=>t.orderId)})}),i||r){this.playNotificationSound();const s="检测到新订单: "+t.orderId;this.isMobile?this.$notify({title:"新订单提醒",message:s,type:"success",duration:4e3,position:"top-right",customClass:"mobile-notification",offset:20}):(this.$message.success(s),"granted"===Notification.permission&&new Notification("新订单提醒",{body:s,icon:"/logo.png",tag:t.orderId,requireInteraction:!0}))}}catch(s){console.error("处理新订单时出现错误:",s),this.isMobile?this.$notify.error({title:"错误",message:"更新订单列表失败",duration:3e3,position:"top",customClass:"mobile-notification"}):this.$message.error("更新订单列表失败")}},async openScanner(t){this.currentOrder=t,this.showScanner=!0;try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("您的浏览器不支持访问摄像头");l["Message"].info("请在弹出的权限请求中允许访问摄像头");const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}}});this.stream=t;const s=this.$refs.video;if(!s)throw new Error("视频元素未准备就绪");s.srcObject=t,await new Promise(t=>{s.onloadedmetadata=()=>{t()}}),await s.play(),this.startQRScanning()}catch(s){console.error("Camera error:",s),"NotAllowedError"===s.name||"PermissionDeniedError"===s.name?l["Message"].error("摄像头访问被拒绝，请在浏览器设置中允许访问摄像头"):"NotFoundError"===s.name?l["Message"].error("未检测到摄像头设备"):"NotReadableError"===s.name?l["Message"].error("摄像头可能正被其他应用使用"):l["Message"].error(s.message||"无法访问摄像头，请确保已授予权限"),this.closeScanner()}},startQRScanning(){this.scanningInterval||(this.scanningInterval=setInterval(()=>{this.scanQRCode()},500))},async scanQRCode(){if(!this.$refs.video||!this.$refs.canvas)return;const t=this.$refs.video,s=this.$refs.canvas,e=s.getContext("2d");s.width=t.videoWidth,s.height=t.videoHeight,e.drawImage(t,0,0,s.width,s.height);const a=e.getImageData(0,0,s.width,s.height),i=o()(a.data,a.width,a.height);if(i){this.stopScanning();try{const t=this.currentOrder.userId._id||this.currentOrder.userId,s=await this.$api.post("/api/channels/f2f/payment",{orderId:this.currentOrder.orderId,userId:t,qrCode:i.data});if(s.data.success){if(this.$message.success("扫码成功，正在处理支付"),!this.$socket)throw console.error("Socket not connected"),new Error("网络连接异常，请刷新页面重试");this.$socket.emit("f2f-payment-url",{room:"order:"+this.currentOrder.orderId,data:{orderId:this.currentOrder.orderId,payUrl:s.data.payUrl}}),this.closeScanner()}}catch(r){console.error("扫码处理错误:",r),this.$message.error(r.message||"扫码处理失败，请重试")}}},closeScanner(){this.stream&&(this.stream.getTracks().forEach(t=>{t.stop()}),this.stream=null),this.scanningInterval&&(clearInterval(this.scanningInterval),this.scanningInterval=null),this.$refs.video&&(this.$refs.video.srcObject=null),this.showScanner=!1,this.currentOrder=null},stopScanning(){clearInterval(this.scanningInterval),this.scanningInterval=null},async handleQRCode(t){try{this.stopScanning();const s=this.currentOrder.userId._id||this.currentOrder.userId,e=await this.$api.post("/api/channels/f2f/payment",{orderId:this.currentOrder.orderId,userId:s,qrCode:t.data});if(!e.data.success)throw new Error(e.data.message||"支付处理失败");{if(this.$message.success("扫码成功，正在处理支付"),!this.$socket)throw new Error("网络连接异常，请刷新页面重试");const t="order:"+this.currentOrder.orderId;this.$socket.emit("join-room",t),await new Promise(t=>setTimeout(t,500)),this.$socket.emit("f2f-payment-url",{room:t,data:{orderId:this.currentOrder.orderId,payUrl:e.data.payUrl}}),this.$socket.once("f2f-payment-url-received:"+this.currentOrder.orderId,()=>{this.closeScanner()}),setTimeout(()=>{this.closeScanner(),this.$message({type:"warning",message:"支付页面可能未正确打开，请刷新页面重试",duration:3e3})},5e3)}}catch(s){console.error("扫码处理错误:",s),this.$message.error(s.message||"扫码处理失败，请重试"),this.startScanning()}},async processQRCode(){if(!this.$refs.video||!this.$refs.canvas)return;const t=this.$refs.video,s=this.$refs.canvas,e=s.getContext("2d");s.width=t.videoWidth,s.height=t.videoHeight,e.drawImage(t,0,0,s.width,s.height);const a=e.getImageData(0,0,s.width,s.height),i=o()(a.data,a.width,a.height);i&&await this.handleQRCode(i)},async initializeScanner(t){try{this.currentOrder=t,this.showScanner=!0,await this.$nextTick(),this.stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:this.isMobile?"environment":"user"}});const s=this.$refs.video;if(!s)throw new Error("视频元素未找到");s.srcObject=this.stream,await s.play(),this.scanningInterval=setInterval(()=>{this.processQRCode()},500)}catch(s){console.error("初始化扫描器错误:",s),this.$message.error("无法访问摄像头，请确保已授予权限"),this.closeScanner()}},toggleOrderDetails(t){this.$set(t,"showDetails",!t.showDetails)}},watch:{filters:{deep:!0,handler(){this.loadOrders(1)}},"$route.query.orderId":{handler(t){t&&this.handleOrderIdChange(t)},immediate:!0}},created(){this.loadColumnSettings(),this.checkMobile(),this.showFilters=!this.isMobile,this.loadBlacklist().then(()=>{this.loadOrders()}),this.loadChannels(),this.startAutoRefresh(),window.addEventListener("resize",()=>{this.checkMobile(),this.isMobile?this.showFilters=!1:this.showFilters=!0}),this.notificationAudio=new Audio("/notification.mp3"),"granted"!==Notification.permission&&"denied"!==Notification.permission&&Notification.requestPermission(),this.$socket&&(this.$socket.off("newOrder"),this.$socket.on("newOrder",t=>{t&&t.orderId&&this.handleNewOrder(t)})),this.orders&&this.orders.forEach(t=>{"undefined"===typeof t.isOnline&&this.$set(t,"isOnline",!1)}),this.onlineStatusTimer=setInterval(()=>{this.$socket&&this.orders.length>0&&this.$socket.emit("refresh-online-status",{orderIds:this.orders.map(t=>t.orderId)})},3e4)},beforeDestroy(){this.stopAutoRefresh(),this.searchTimeout&&clearTimeout(this.searchTimeout),window.removeEventListener("resize",this.checkMobile),this.$socket&&(this.orders.forEach(t=>{this.$socket.off("chat:"+t.orderId)}),this.$socket.off("newOrder")),this.notificationAudio&&(this.notificationAudio.pause(),this.notificationAudio=null),this.selectedOrder&&this.$root.$emit("chat-window-state",this.selectedOrder.orderId,!1),this.onlineStatusTimer&&clearInterval(this.onlineStatusTimer)},beforeRouteEnter(t,s,e){e(t=>{t.initializeSocket(),t.$socket&&t.orders.length>0&&t.$socket.emit("refresh-online-status",{orderIds:t.orders.map(t=>t.orderId)})})},beforeRouteUpdate(t,s,e){e(),this.initializeSocket(),this.$socket&&this.orders.length>0&&this.$socket.emit("refresh-online-status",{orderIds:this.orders.map(t=>t.orderId)})}},d=c,u=(e("9361"),e("2877")),h=Object(u["a"])(d,a,i,!1,null,"105a38d8",null);s["a"]=h.exports},5379:function(t,s,e){},9361:function(t,s,e){"use strict";e("5379")},a55b:function(t,s,e){"use strict";var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"login-container",class:t.currentTheme},[s("div",{staticClass:"theme-switcher"},t._l(t.themes,(function(e){return s("button",{key:e.name,class:["theme-btn",{active:t.currentTheme===e.name}],style:{background:e.color},attrs:{title:e.label},on:{click:function(s){return t.setTheme(e.name)}}},[t.currentTheme===e.name?s("i",{staticClass:"fas fa-check"}):t._e()])})),0),s("div",{staticClass:"login-box"},[t._m(0),s("div",{staticClass:"login-form-container"},[s("div",{staticClass:"form-header"},[s("h2",[t._v(t._s(t.isRegister?"创建账号":"欢迎回来"))]),s("p",[t._v(t._s(t.isRegister?"请填写以下信息创建您的账号":"请登录您的账号"))])]),s("form",{staticClass:"login-form",on:{submit:function(s){return s.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"username"}},[t._v("用户名")]),s("div",{staticClass:"input-group"},[s("i",{staticClass:"fas fa-user"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.username,expression:"form.username"}],attrs:{id:"username",type:"text",placeholder:"请输入用户名",required:""},domProps:{value:t.form.username},on:{input:function(s){s.target.composing||t.$set(t.form,"username",s.target.value)}}})])]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"password"}},[t._v("密码")]),s("div",{staticClass:"input-group"},[s("i",{staticClass:"fas fa-lock"}),"checkbox"===(t.showPassword?"text":"password")?s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.password,expression:"form.password"}],attrs:{id:"password",placeholder:"请输入密码",required:"",type:"checkbox"},domProps:{checked:Array.isArray(t.form.password)?t._i(t.form.password,null)>-1:t.form.password},on:{change:function(s){var e=t.form.password,a=s.target,i=!!a.checked;if(Array.isArray(e)){var r=null,n=t._i(e,r);a.checked?n<0&&t.$set(t.form,"password",e.concat([r])):n>-1&&t.$set(t.form,"password",e.slice(0,n).concat(e.slice(n+1)))}else t.$set(t.form,"password",i)}}}):"radio"===(t.showPassword?"text":"password")?s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.password,expression:"form.password"}],attrs:{id:"password",placeholder:"请输入密码",required:"",type:"radio"},domProps:{checked:t._q(t.form.password,null)},on:{change:function(s){return t.$set(t.form,"password",null)}}}):s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.password,expression:"form.password"}],attrs:{id:"password",placeholder:"请输入密码",required:"",type:t.showPassword?"text":"password"},domProps:{value:t.form.password},on:{input:function(s){s.target.composing||t.$set(t.form,"password",s.target.value)}}}),s("i",{staticClass:"fas toggle-password",class:t.showPassword?"fa-eye-slash":"fa-eye",on:{click:function(s){t.showPassword=!t.showPassword}}})])]),s("transition",{attrs:{name:"slide-fade"}},[t.isRegister?s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"email"}},[t._v("邮箱")]),s("div",{staticClass:"input-group"},[s("i",{staticClass:"fas fa-envelope"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.email,expression:"form.email"}],attrs:{id:"email",type:"email",placeholder:"请输入邮箱",required:""},domProps:{value:t.form.email},on:{input:function(s){s.target.composing||t.$set(t.form,"email",s.target.value)}}})])]):t._e()]),s("transition",{attrs:{name:"slide-fade"}},[t.isRegister?s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"inviteCode"}},[t._v("邀请码")]),s("div",{staticClass:"input-group"},[s("i",{staticClass:"fas fa-key"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.inviteCode,expression:"form.inviteCode"}],attrs:{id:"inviteCode",type:"text",placeholder:"请输入邀请码",required:""},domProps:{value:t.form.inviteCode},on:{input:function(s){s.target.composing||t.$set(t.form,"inviteCode",s.target.value)}}})])]):t._e()]),t.isRegister?t._e():s("div",{staticClass:"form-options"},[s("label",{staticClass:"checkbox-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.rememberMe,expression:"form.rememberMe"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.form.rememberMe)?t._i(t.form.rememberMe,null)>-1:t.form.rememberMe},on:{change:function(s){var e=t.form.rememberMe,a=s.target,i=!!a.checked;if(Array.isArray(e)){var r=null,n=t._i(e,r);a.checked?n<0&&t.$set(t.form,"rememberMe",e.concat([r])):n>-1&&t.$set(t.form,"rememberMe",e.slice(0,n).concat(e.slice(n+1)))}else t.$set(t.form,"rememberMe",i)}}}),s("span",{staticClass:"checkbox-label"},[t._v("记住我")])]),s("a",{staticClass:"forgot-link",attrs:{href:"#"}},[t._v("忘记密码？")])]),s("button",{staticClass:"submit-button",attrs:{type:"submit",disabled:t.loading||!t.isFormValid}},[t.loading?s("div",{staticClass:"loading-spinner"}):s("span",[t._v(t._s(t.isRegister?"注册":"登录"))])]),s("div",{staticClass:"switch-mode"},[s("p",[t._v(" "+t._s(t.isRegister?"已有账号？":"还没有账号？")+" "),s("a",{attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),t.switchMode(!t.isRegister)}}},[t._v(" "+t._s(t.isRegister?"立即登录":"立即注册")+" ")])])])],1),s("transition",{attrs:{name:"fade"}},[t.error?s("div",{staticClass:"error-alert"},[s("i",{staticClass:"fas fa-exclamation-circle"}),s("span",[t._v(t._s(t.error))])]):t._e()])],1)])])},i=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"login-decoration"},[s("div",{staticClass:"decoration-content"},[s("h1",[t._v("通道市场管理系统")]),s("p",[t._v("专业的支付通道管理平台")]),s("div",{staticClass:"decoration-shapes"},[s("div",{staticClass:"shape shape-1"}),s("div",{staticClass:"shape shape-2"}),s("div",{staticClass:"shape shape-3"})])])])}],r=(e("d9e2"),e("14d9"),e("0c12")),n={name:"Login",data(){return{isRegister:!1,form:{username:"",password:"",email:"",rememberMe:!1,inviteCode:""},loading:!1,error:null,showPassword:!1,currentTheme:localStorage.getItem("theme")||"default",themes:[{name:"default",label:"默认主题",color:"#6366F1"},{name:"ocean",label:"海洋主题",color:"#0EA5E9"},{name:"forest",label:"森林主题",color:"#10B981"},{name:"sunset",label:"日落主题",color:"#F59E0B"},{name:"royal",label:"皇家主题",color:"#8B5CF6"}]}},computed:{isFormValid(){const{username:t,password:s,email:e}=this.form;return this.isRegister?t&&s&&e&&this.isValidEmail(e):t&&s}},methods:{isValidEmail(t){const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return s.test(t)},switchMode(t){this.isRegister=t,this.error=null,this.form.email=""},async handleSubmit(){try{if(this.loading=!0,this.error=null,this.isRegister){const t=await this.$api.post("/api/auth/register",{username:this.form.username,password:this.form.password,email:this.form.email,inviteCode:this.form.inviteCode});if(t.data.success)return void this.$alert(t.data.message||"注册成功，请登录","提示",{confirmButtonText:"确定",type:"success",center:!0,callback:()=>{this.isRegister=!1,this.error=null;const t=this.form.username;this.form={username:t,password:"",email:"",inviteCode:"",rememberMe:!1}}});throw new Error(t.data.message)}{const t=await this.$api.post("/api/auth/login",{username:this.form.username,password:this.form.password});t.data.success&&(localStorage.setItem("token",t.data.token),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("username",t.data.username),localStorage.setItem("userRole",t.data.role),localStorage.setItem("currentUserId",t.data.userId),r["a"].$emit("login-state-changed",!0),await this.$nextTick(),"/channel-market"!==this.$route.path&&await this.$router.replace("/channel-market"))}}catch(t){if("NavigationDuplicated"===t.name)return;console.error("Login error:",t),this.error=t.message||"登录失败，请稍后重试"}finally{this.loading=!1}},setTheme(t){this.currentTheme=t,localStorage.setItem("theme",t)}},created(){"true"===localStorage.getItem("isLoggedIn")&&this.$router.push("/channel-market");const t=localStorage.getItem("theme");t&&(this.currentTheme=t)}},o=n,l=(e("db6e"),e("2877")),c=Object(l["a"])(o,a,i,!1,null,"e3f02020",null);s["a"]=c.exports},b2c3:function(t,s,e){"use strict";var a=function(){var t=this,s=t._self._c;return s("div",[s("h2",[t._v("语音客服")]),s("div",{staticClass:"voice-service"},[t._m(0),s("div",{staticClass:"call-action"},[s("button",{on:{click:t.startCall}},[t._v("开始通话")])])]),t.callStatus?s("div",{staticClass:"call-status"},[t._v(" "+t._s(t.callStatus)+" ")]):t._e()])},i=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"service-info"},[s("p",[t._v("客服热线: 400-123-4567")]),s("p",[t._v("服务时间: 周一至周五 9:00-18:00")])])}],r={name:"VoiceService",data(){return{callStatus:""}},methods:{startCall(){this.callStatus="正在连接客服...",setTimeout(()=>{this.callStatus="已接通，正在通话中..."},2e3)}}},n=r,o=(e("d2b4"),e("2877")),l=Object(o["a"])(n,a,i,!1,null,"80163a3c",null);s["a"]=l.exports},d2b4:function(t,s,e){"use strict";e("d996")},d98c:function(t,s,e){},d996:function(t,s,e){},db6e:function(t,s,e){"use strict";e("d98c")},edf8:function(t,s,e){},fee6:function(t,s,e){"use strict";e("edf8")}});
//# sourceMappingURL=app~b1bc70ec.78118480.js.map