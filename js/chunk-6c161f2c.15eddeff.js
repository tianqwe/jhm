(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c161f2c"],{"196e":function(s,t,a){"use strict";a.r(t);var e=function(){var s,t,a=this,e=a._self._c;return e("div",{staticClass:"user-management"},[e("div",{staticClass:"header"},[e("div",{staticClass:"header-left"},[e("h2",[a._v("用户管理")]),e("span",{staticClass:"user-count"},[a._v("共 "+a._s(a.users.length)+" 个用户")])]),e("div",{staticClass:"search-box"},[e("i",{staticClass:"fas fa-search"}),e("input",{directives:[{name:"model",rawName:"v-model",value:a.searchQuery,expression:"searchQuery"}],attrs:{placeholder:"搜索用户名或邮箱..."},domProps:{value:a.searchQuery},on:{input:function(s){s.target.composing||(a.searchQuery=s.target.value)}}})])]),a.loading?e("div",{staticClass:"loading-state"},[e("div",{staticClass:"spinner"}),e("span",[a._v("加载中...")])]):a._e(),a.error?e("div",{staticClass:"error-message"},[e("i",{staticClass:"fas fa-exclamation-circle"}),e("span",[a._v(a._s(a.error))]),e("button",{staticClass:"retry-btn",on:{click:a.loadUsers}},[e("i",{staticClass:"fas fa-redo"}),a._v(" 重试 ")])]):e("div",{staticClass:"users-grid"},a._l(a.filteredUsers,(function(s){var t,i,n,l;return e("div",{key:s._id,staticClass:"user-card"},[e("div",{staticClass:"user-card-header"},[e("div",{staticClass:"user-info"},[a._m(0,!0),e("div",{staticClass:"user-details"},[e("h3",[a._v(a._s(s.username))]),e("span",{staticClass:"email"},[a._v(a._s(s.email))]),s.lastLoginIp?e("span",{staticClass:"last-login-ip"},[e("i",{staticClass:"fas fa-network-wired"}),a._v(" 最后登录IP: "+a._s(s.lastLoginIp)+" ")]):a._e()])]),e("div",{staticClass:"user-status"},[e("span",{staticClass:"status-badge",class:a.getStatusClass(s.status)},[a._v(" "+a._s(s.status||"正常")+" ")])])]),e("div",{staticClass:"user-stats"},[e("div",{staticClass:"stat-item"},[e("i",{staticClass:"fas fa-wallet"}),e("div",{staticClass:"stat-content"},[e("span",{staticClass:"stat-label"},[a._v("余额")]),e("span",{staticClass:"stat-value"},[a._v("¥"+a._s(a.formatAmount(s.balance)))])])]),e("div",{staticClass:"stat-item"},[e("i",{staticClass:"fas fa-calendar-alt"}),e("div",{staticClass:"stat-content"},[e("span",{staticClass:"stat-label"},[a._v("注册时间")]),e("span",{staticClass:"stat-value"},[a._v(a._s(a.formatDate(s.createdAt)))])])])]),e("div",{staticClass:"user-actions"},[e("button",{staticClass:"action-btn",class:{active:(null===(t=a.selectedUser)||void 0===t?void 0:t._id)===s._id},on:{click:function(t){return a.toggleUserDetails(s)}}},[e("i",{class:(null===(i=a.selectedUser)||void 0===i?void 0:i._id)===s._id?"fas fa-chevron-up":"fas fa-chevron-down"}),a._v(" "+a._s((null===(n=a.selectedUser)||void 0===n?void 0:n._id)===s._id?"收起详情":"查看详情")+" ")]),e("button",{staticClass:"action-btn primary",on:{click:function(t){return a.showBalanceModal(s)}}},[e("i",{staticClass:"fas fa-coins"}),a._v(" 调整余额 ")]),e("button",{staticClass:"action-btn",class:{danger:!s.status},on:{click:function(t){return a.toggleUserStatus(s)}}},[e("i",{class:s.status?"fas fa-ban":"fas fa-check-circle"}),a._v(" "+a._s(s.status?"封禁":"解封")+" ")])]),(null===(l=a.selectedUser)||void 0===l?void 0:l._id)===s._id?e("div",{staticClass:"details-panel"},[e("div",{staticClass:"details-section"},[a._m(1,!0),e("div",{staticClass:"channels-grid"},a._l(s.channels,(function(s){var t;return e("div",{key:s.id,staticClass:"channel-card"},[e("div",{staticClass:"channel-header"},[e("span",{staticClass:"channel-name"},[a._v(a._s(s.name))]),e("span",{staticClass:"channel-status",class:{enabled:"启用"===s.status}},[a._v(" "+a._s(s.status)+" ")])]),e("div",{staticClass:"channel-body"},[e("div",{staticClass:"channel-info"},[e("span",{staticClass:"label"},[a._v("通道ID")]),e("span",{staticClass:"value"},[a._v(a._s(s.identifier))])]),e("div",{staticClass:"channel-info"},[e("span",{staticClass:"label"},[a._v("支付参数")]),e("span",{staticClass:"value"},[a._v(a._s((null===(t=s.customParams)||void 0===t?void 0:t.userId)||"未设置"))])]),e("div",{staticClass:"channel-info"},[e("span",{staticClass:"label"},[a._v("累计金额")]),e("span",{staticClass:"value highlight"},[a._v("¥"+a._s(a.formatAmount(s.totalAmount)))])])])])})),0)]),e("div",{staticClass:"details-section"},[a._m(2,!0),e("div",{staticClass:"transactions-list"},a._l(s.transactions,(function(s){return e("div",{key:s._id,staticClass:"transaction-item"},[e("div",{staticClass:"tx-icon",class:a.getTxTypeClass(s.type)},[e("i",{class:a.getTxIcon(s.type)})]),e("div",{staticClass:"tx-info"},[e("div",{staticClass:"tx-header"},[e("span",{staticClass:"tx-type"},[a._v(a._s(s.type))]),e("span",{staticClass:"tx-time"},[a._v(a._s(a.formatDate(s.createdAt)))])]),e("div",{staticClass:"tx-details"},[e("span",{staticClass:"tx-amount",class:{positive:s.amount>0,negative:s.amount<0}},[a._v(" "+a._s(s.amount>0?"+":"")+a._s(a.formatAmount(s.amount))+" ")]),e("span",{staticClass:"tx-balance"},[a._v("余额: ¥"+a._s(a.formatAmount(s.balance)))])]),s.description?e("div",{staticClass:"tx-desc"},[a._v(" "+a._s(s.description)+" ")]):a._e()])])})),0)])]):a._e()])})),0),a.showBalanceDialog?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal",on:{click:function(s){s.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("div",{staticClass:"header-content"},[e("h3",[a._v("调整余额")]),e("div",{staticClass:"user-brief"},[e("span",{staticClass:"username"},[a._v(a._s(null===(s=a.selectedUser)||void 0===s?void 0:s.username))]),e("span",{staticClass:"current-balance"},[a._v("当前余额: ¥"+a._s(a.formatAmount(null===(t=a.selectedUser)||void 0===t?void 0:t.balance)))])])]),e("button",{staticClass:"close-btn",on:{click:a.closeBalanceModal}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-content"},[e("div",{staticClass:"adjustment-type"},[e("button",{class:["type-btn",{active:"增加"===a.balanceAdjustment.type}],on:{click:function(s){a.balanceAdjustment.type="增加"}}},[e("i",{staticClass:"fas fa-plus-circle"}),a._v(" 增加 ")]),e("button",{class:["type-btn",{active:"减少"===a.balanceAdjustment.type}],on:{click:function(s){a.balanceAdjustment.type="减少"}}},[e("i",{staticClass:"fas fa-minus-circle"}),a._v(" 减少 ")])]),e("div",{staticClass:"input-group"},[e("label",[a._v("金额")]),e("div",{staticClass:"amount-input"},[e("span",{staticClass:"currency"},[a._v("¥")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.balanceAdjustment.amount,expression:"balanceAdjustment.amount"}],attrs:{type:"number",min:"0",step:"0.01",placeholder:"请输入调整金额"},domProps:{value:a.balanceAdjustment.amount},on:{input:function(s){s.target.composing||a.$set(a.balanceAdjustment,"amount",s.target.value)}}})])]),e("div",{staticClass:"input-group"},[e("label",[a._v("说明")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.balanceAdjustment.description,expression:"balanceAdjustment.description"}],attrs:{type:"text",placeholder:"请输入调整原因"},domProps:{value:a.balanceAdjustment.description},on:{input:function(s){s.target.composing||a.$set(a.balanceAdjustment,"description",s.target.value)}}})]),e("div",{staticClass:"preview-section"},[e("div",{staticClass:"preview-item"},[e("span",{staticClass:"label"},[a._v("调整后余额")]),e("span",{staticClass:"value",class:{negative:a.getAdjustedBalance<0}},[a._v(" ¥"+a._s(a.formatAmount(a.getAdjustedBalance))+" ")])])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"cancel-btn",on:{click:a.closeBalanceModal}},[a._v("取消")]),e("button",{staticClass:"confirm-btn",class:{danger:"减少"===a.balanceAdjustment.type},attrs:{disabled:!a.isValidAdjustment||a.getAdjustedBalance<0},on:{click:a.confirmBalanceAdjustment}},[a._v(" 确认"+a._s(a.balanceAdjustment.type)+" ")])])])]):a._e()])},i=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"avatar"},[t("i",{staticClass:"fas fa-user"})])},function(){var s=this,t=s._self._c;return t("h4",[t("i",{staticClass:"fas fa-random"}),s._v(" 通道设置 ")])},function(){var s=this,t=s._self._c;return t("h4",[t("i",{staticClass:"fas fa-history"}),s._v(" 交易记录 ")])}],n=(a("d9e2"),a("14d9"),a("0643"),a("2382"),a("a573"),{name:"UserManagement",data(){return{users:[],loading:!1,error:null,searchQuery:"",expandedUser:null,showBalanceDialog:!1,selectedUser:null,balanceAdjustment:{type:"增加",amount:"",description:""},showDetailsDialog:!1}},computed:{filteredUsers(){if(!this.searchQuery)return this.users;const s=this.searchQuery.toLowerCase();return this.users.filter(t=>t.username.toLowerCase().includes(s)||t.email.toLowerCase().includes(s))},isValidAdjustment(){const s=parseFloat(this.balanceAdjustment.amount);return s>0&&this.balanceAdjustment.description},getAdjustedBalance(){var s;if(!this.selectedUser||!this.balanceAdjustment.amount)return(null===(s=this.selectedUser)||void 0===s?void 0:s.balance)||0;const t=parseFloat(this.balanceAdjustment.amount)||0;return this.selectedUser.balance+("减少"===this.balanceAdjustment.type?-t:t)}},methods:{async loadUsers(){try{this.loading=!0,this.error=null;const s=localStorage.getItem("userRole"),t=localStorage.getItem("token");if(!t||"superadmin"!==s)throw new Error("权限不足或未登录");const a=await this.$api.get("/api/users/list");this.users=a.data}catch(t){var s;if(console.error("Load users error:",t),401===(null===(s=t.response)||void 0===s?void 0:s.status)){localStorage.clear();try{await this.$router.replace("/"),this.$message.error("登录已过期，请重新登录")}catch(a){"NavigationDuplicated"!==a.name&&console.error("Router navigation error:",a)}return}this.error=t.message||"加载用户列表失败",this.$message.error(this.error)}finally{this.loading=!1}},async updateUserRole(s,t){try{await this.$api.put(`/users/${s}/role`,{role:t}),this.$message.success("更新用户角色成功")}catch(a){console.error("Update role error:",a),this.$message.error("更新用户角色失败"),await this.loadUsers()}},formatAmount(s){return parseFloat(s).toFixed(2)},formatDate(s){return new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getStatusClass(s){return{"status-normal":!s,"status-banned":"已封禁"===s}},getTxTypeClass(s){return{"tx-recharge":"充值"===s,"tx-withdraw":"提现"===s,"tx-income":"收入"===s,"tx-expense":"支出"===s}},async toggleUserDetails(s){var t;if((null===(t=this.selectedUser)||void 0===t?void 0:t._id)!==s._id)try{const[t,a]=await Promise.all([this.$api.get(`/api/users/${s._id}/channels`),this.$api.get(`/api/users/${s._id}/transactions`)]),e=this.users.findIndex(t=>t._id===s._id);if(-1!==e){const s=t.data.map(s=>{var t;return{...s,customParams:{...s.customParams,userId:(null===(t=s.customParams)||void 0===t?void 0:t.userId)||"未设置"}}});this.$set(this.users[e],"channels",s),this.$set(this.users[e],"transactions",a.data),this.selectedUser=this.users[e]}}catch(a){console.error("Load user details error:",a),this.$message.error("加载用户详情失败")}else this.selectedUser=null},async toggleUserStatus(s){try{const t=s.status?null:"已封禁";await this.$api.put(`/api/users/${s._id}/status`,{status:t});const a=this.users.findIndex(t=>t._id===s._id);-1!==a&&this.$set(this.users[a],"status",t),this.$message.success(t?"用户已封禁":"用户已解封")}catch(t){this.$message.error("操作失败"),console.error("Toggle user status error:",t)}},showBalanceModal(s){this.selectedUser=s,this.balanceAdjustment={type:"增加",amount:"",description:""},this.showBalanceDialog=!0},closeBalanceModal(){this.showBalanceDialog=!1,this.selectedUser=null,this.balanceAdjustment={type:"增加",amount:"",description:""}},async confirmBalanceAdjustment(){try{const s=parseFloat(this.balanceAdjustment.amount),t="减少"===this.balanceAdjustment.type?-s:s;await this.$api.post(`/api/users/${this.selectedUser._id}/balance`,{amount:t,description:this.balanceAdjustment.description});const a=this.users.findIndex(s=>s._id===this.selectedUser._id);-1!==a&&this.$set(this.users[a],"balance",parseFloat(this.users[a].balance)+t),this.$message.success("余额调整成功"),this.closeBalanceModal()}catch(s){this.$message.error("余额调整失败"),console.error("Balance adjustment error:",s)}},getTxIcon(s){const t={"充值":"fas fa-plus-circle","提现":"fas fa-minus-circle","收入":"fas fa-arrow-down","支出":"fas fa-arrow-up","管理员充值":"fas fa-user-shield","管理员扣除":"fas fa-user-slash"};return t[s]||"fas fa-exchange-alt"},async showUserDetails(s){try{const[t,a]=await Promise.all([this.$api.get(`/api/users/${s._id}/channels`),this.$api.get(`/api/users/${s._id}/transactions`)]),e=this.users.findIndex(t=>t._id===s._id);if(-1!==e){const s=t.data.map(s=>{var t;return{...s,customParams:{...s.customParams,userId:(null===(t=s.customParams)||void 0===t?void 0:t.userId)||"未设置"}}});this.$set(this.users[e],"channels",s),this.$set(this.users[e],"transactions",a.data)}this.selectedUser=this.users[e],this.showDetailsDialog=!0}catch(t){console.error("Load user details error:",t),this.$message.error("加载用户详情失败")}},closeDetailsModal(){this.showDetailsDialog=!1,this.selectedUser=null}},created(){const s=localStorage.getItem("userRole");if("superadmin"!==s)return this.$message.error("权限不足"),void this.$router.push("/channel-market");this.loadUsers()}}),l=n,r=(a("a744"),a("2877")),c=Object(r["a"])(l,e,i,!1,null,"31a69729",null);t["default"]=c.exports},"1abb":function(s,t,a){},a744:function(s,t,a){"use strict";a("1abb")}}]);
//# sourceMappingURL=chunk-6c161f2c.15eddeff.js.map